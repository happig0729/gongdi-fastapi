2025-06-08 09:44:09,441 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:44:10,144 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:44:10,471 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:44:10,943 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:44:11,316 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:44:26,597 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:44:26,776 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:44:27,103 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:44:27,323 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:44:37,161 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:45:02,416 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:45:46,544 - gongdi-api - DEBUG - 接收到函数调用请求: {'query': '时间', 'tools': [{}]}
2025-06-08 09:45:46,545 - gongdi-api - DEBUG - 使用默认工具: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 09:45:46,547 - gongdi-api - DEBUG - 调用DashscopeClient处理请求，query: 时间
2025-06-08 09:45:46,548 - gongdi-api.dashscope - DEBUG - DashscopeClient初始化: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 09:45:46,548 - gongdi-api.dashscope - DEBUG - 接收function_call请求: messages=[{'role': 'user', 'content': '时间'}]
2025-06-08 09:45:46,549 - gongdi-api.dashscope - DEBUG - 原始工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 09:45:46,550 - gongdi-api.dashscope - DEBUG - 格式化后的工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 09:45:46,552 - gongdi-api.dashscope - DEBUG - 调用DashScope API参数: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 09:45:46,553 - gongdi-api.dashscope - DEBUG - 开始调用DashScope API...
2025-06-08 09:45:46,676 - dashscope - DEBUG - Request body: {'model': 'qwen-turbo', 'parameters': {'tools': [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}], 'temperature': 0, 'max_tokens': 2048, 'result_format': 'message'}, 'input': {'messages': [{'role': 'user', 'content': '时间'}]}}
2025-06-08 09:45:46,685 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): dashscope.aliyuncs.com:443
2025-06-08 09:45:48,981 - urllib3.connectionpool - DEBUG - https://dashscope.aliyuncs.com:443 "POST /api/v1/services/aigc/text-generation/generation HTTP/1.1" 200 None
2025-06-08 09:45:48,983 - dashscope - DEBUG - Response: {'output': {'choices': [{'finish_reason': 'tool_calls', 'message': {'role': 'assistant', 'tool_calls': [{'function': {'name': 'get_current_time', 'arguments': '{}'}, 'index': 0, 'id': 'call_e00f4efa187e4e88b8166e', 'type': 'function'}], 'content': ''}}]}, 'usage': {'total_tokens': 235, 'output_tokens': 13, 'input_tokens': 222, 'prompt_tokens_details': {'cached_tokens': 0}}, 'request_id': '181918cd-b9f0-963a-b52f-3aa7c50ddfb7'}
2025-06-08 09:45:48,989 - gongdi-api.dashscope - DEBUG - DashScope API响应状态码: 200
2025-06-08 09:45:48,989 - gongdi-api.dashscope - DEBUG - 成功处理响应: request_id=181918cd-b9f0-963a-b52f-3aa7c50ddfb7
2025-06-08 09:45:48,990 - gongdi-api - DEBUG - API响应: {'status_code': <HTTPStatus.OK: 200>, 'request_id': '181918cd-b9f0-963a-b52f-3aa7c50ddfb7', 'choices': [{'message': Message({'role': 'assistant', 'content': '', 'tool_calls': [{'function': {'name': 'get_current_time', 'arguments': '{}'}, 'index': 0, 'id': 'call_e00f4efa187e4e88b8166e', 'type': 'function'}]})}], 'usage': {}}
2025-06-08 09:45:48,991 - gongdi-api - DEBUG - 工具调用信息: {'id': 'call_e00f4efa187e4e88b8166e', 'function_name': 'get_current_time', 'arguments': {}}
2025-06-08 09:45:48,992 - gongdi-api - DEBUG - 最终返回结果: {'status_code': <HTTPStatus.OK: 200>, 'request_id': '181918cd-b9f0-963a-b52f-3aa7c50ddfb7', 'message': Message({'role': 'assistant', 'content': '', 'tool_calls': [{'function': {'name': 'get_current_time', 'arguments': '{}'}, 'index': 0, 'id': 'call_e00f4efa187e4e88b8166e', 'type': 'function'}]}), 'tool_calls': [{'id': 'call_e00f4efa187e4e88b8166e', 'function_name': 'get_current_time', 'arguments': {}}]}
2025-06-08 09:48:07,110 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:48:07,661 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:48:07,801 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:48:07,830 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:48:08,176 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:48:08,606 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:51:35,137 - gongdi-api - DEBUG - 接收到函数调用请求: {'query': '??????', 'tools': None}
2025-06-08 09:51:35,138 - gongdi-api - DEBUG - 使用默认工具: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 09:51:35,139 - gongdi-api - DEBUG - 调用DashscopeClient处理请求，query: ??????
2025-06-08 09:51:35,140 - gongdi-api.dashscope - DEBUG - DashscopeClient初始化: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 09:51:35,141 - gongdi-api.dashscope - DEBUG - 接收function_call请求: messages=[{'role': 'user', 'content': '??????'}]
2025-06-08 09:51:35,141 - gongdi-api.dashscope - DEBUG - 原始工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 09:51:35,142 - gongdi-api.dashscope - DEBUG - 格式化后的工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 09:51:35,145 - gongdi-api.dashscope - DEBUG - 调用DashScope API参数: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 09:51:35,145 - gongdi-api.dashscope - DEBUG - 开始调用DashScope API...
2025-06-08 09:51:35,243 - dashscope - DEBUG - Request body: {'model': 'qwen-turbo', 'parameters': {'tools': [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}], 'temperature': 0, 'max_tokens': 2048, 'result_format': 'message'}, 'input': {'messages': [{'role': 'user', 'content': '??????'}]}}
2025-06-08 09:51:35,250 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): dashscope.aliyuncs.com:443
2025-06-08 09:51:38,230 - urllib3.connectionpool - DEBUG - https://dashscope.aliyuncs.com:443 "POST /api/v1/services/aigc/text-generation/generation HTTP/1.1" 200 None
2025-06-08 09:51:38,232 - dashscope - DEBUG - Response: {'output': {'choices': [{'finish_reason': 'stop', 'message': {'role': 'assistant', 'content': '您好！看起来您可能有具体的问题或需求需要帮助。如果您有任何问题或需要查询某些信息，请告诉我更多细节，我会尽力为您提供帮助。例如，您想了解当前时间、某个城市的天气情况，还是其他内容？请提供更多信息以便我更好地协助您。'}}]}, 'usage': {'total_tokens': 280, 'output_tokens': 57, 'input_tokens': 223, 'prompt_tokens_details': {'cached_tokens': 128}}, 'request_id': 'e9152157-f3fb-960a-847e-8686b3b9ee6b'}
2025-06-08 09:51:38,238 - gongdi-api.dashscope - DEBUG - DashScope API响应状态码: 200
2025-06-08 09:51:38,239 - gongdi-api.dashscope - DEBUG - 成功处理响应: request_id=e9152157-f3fb-960a-847e-8686b3b9ee6b
2025-06-08 09:51:38,240 - gongdi-api - DEBUG - API响应: {'status_code': <HTTPStatus.OK: 200>, 'request_id': 'e9152157-f3fb-960a-847e-8686b3b9ee6b', 'choices': [{'message': Message({'role': 'assistant', 'content': '您好！看起来您可能有具体的问题或需求需要帮助。如果您有任何问题或需要查询某些信息，请告诉我更多细节，我会尽力为您提供帮助。例如，您想了解当前时间、某个城市的天气情况，还是其他内容？请提供更多信息以便我更好地协助您。'})}], 'usage': {}}
2025-06-08 09:51:38,241 - gongdi-api - DEBUG - 响应中没有工具调用
2025-06-08 09:51:40,835 - gongdi-api - DEBUG - 接收到函数调用请求: {'query': '??????', 'tools': None}
2025-06-08 09:51:40,836 - gongdi-api - DEBUG - 使用默认工具: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 09:51:40,838 - gongdi-api - DEBUG - 调用DashscopeClient处理请求，query: ??????
2025-06-08 09:51:40,838 - gongdi-api.dashscope - DEBUG - DashscopeClient初始化: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 09:51:40,839 - gongdi-api.dashscope - DEBUG - 接收function_call请求: messages=[{'role': 'user', 'content': '??????'}]
2025-06-08 09:51:40,839 - gongdi-api.dashscope - DEBUG - 原始工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 09:51:40,841 - gongdi-api.dashscope - DEBUG - 格式化后的工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 09:51:40,843 - gongdi-api.dashscope - DEBUG - 调用DashScope API参数: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 09:51:40,843 - gongdi-api.dashscope - DEBUG - 开始调用DashScope API...
2025-06-08 09:51:40,845 - dashscope - DEBUG - Request body: {'model': 'qwen-turbo', 'parameters': {'tools': [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}], 'temperature': 0, 'max_tokens': 2048, 'result_format': 'message'}, 'input': {'messages': [{'role': 'user', 'content': '??????'}]}}
2025-06-08 09:51:40,849 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): dashscope.aliyuncs.com:443
2025-06-08 09:51:43,632 - urllib3.connectionpool - DEBUG - https://dashscope.aliyuncs.com:443 "POST /api/v1/services/aigc/text-generation/generation HTTP/1.1" 200 None
2025-06-08 09:51:43,634 - dashscope - DEBUG - Response: {'output': {'choices': [{'finish_reason': 'stop', 'message': {'role': 'assistant', 'content': '您好！看起来您可能有具体的问题或需求需要帮助。请告诉我您想了解什么信息或者需要解决什么问题？这样我可以更好地为您提供支持。'}}]}, 'usage': {'total_tokens': 255, 'output_tokens': 32, 'input_tokens': 223, 'prompt_tokens_details': {'cached_tokens': 0}}, 'request_id': '95e7e3c4-fa21-9254-9cb6-5b039745da4c'}
2025-06-08 09:51:43,640 - gongdi-api.dashscope - DEBUG - DashScope API响应状态码: 200
2025-06-08 09:51:43,641 - gongdi-api.dashscope - DEBUG - 成功处理响应: request_id=95e7e3c4-fa21-9254-9cb6-5b039745da4c
2025-06-08 09:51:43,641 - gongdi-api - DEBUG - API响应: {'status_code': <HTTPStatus.OK: 200>, 'request_id': '95e7e3c4-fa21-9254-9cb6-5b039745da4c', 'choices': [{'message': Message({'role': 'assistant', 'content': '您好！看起来您可能有具体的问题或需求需要帮助。请告诉我您想了解什么信息或者需要解决什么问题？这样我可以更好地为您提供支持。'})}], 'usage': {}}
2025-06-08 09:51:43,643 - gongdi-api - DEBUG - 响应中没有工具调用
2025-06-08 09:52:05,437 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:52:05,515 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:52:05,861 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:52:05,929 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:52:06,103 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:52:06,727 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:52:08,919 - gongdi-api - DEBUG - 接收到函数调用请求: {'query': '现在几点了？', 'tools': None}
2025-06-08 09:52:08,920 - gongdi-api - DEBUG - 使用默认工具: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 09:52:08,921 - gongdi-api - DEBUG - 调用DashscopeClient处理请求，query: 现在几点了？
2025-06-08 09:52:08,922 - gongdi-api.dashscope - DEBUG - DashscopeClient初始化: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 09:52:08,922 - gongdi-api.dashscope - DEBUG - 接收function_call请求: messages=[{'role': 'user', 'content': '现在几点了？'}]
2025-06-08 09:52:08,923 - gongdi-api.dashscope - DEBUG - 原始工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 09:52:08,924 - gongdi-api.dashscope - DEBUG - 格式化后的工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 09:52:08,925 - gongdi-api.dashscope - DEBUG - 调用DashScope API参数: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 09:52:08,926 - gongdi-api.dashscope - DEBUG - 开始调用DashScope API...
2025-06-08 09:52:09,219 - dashscope - DEBUG - Request body: {'model': 'qwen-turbo', 'parameters': {'tools': [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}], 'temperature': 0, 'max_tokens': 2048, 'result_format': 'message'}, 'input': {'messages': [{'role': 'user', 'content': '现在几点了？'}]}}
2025-06-08 09:52:09,229 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): dashscope.aliyuncs.com:443
2025-06-08 09:52:11,538 - urllib3.connectionpool - DEBUG - https://dashscope.aliyuncs.com:443 "POST /api/v1/services/aigc/text-generation/generation HTTP/1.1" 200 None
2025-06-08 09:52:11,541 - dashscope - DEBUG - Response: {'output': {'choices': [{'finish_reason': 'tool_calls', 'message': {'role': 'assistant', 'tool_calls': [{'function': {'name': 'get_current_time', 'arguments': '{}'}, 'index': 0, 'id': 'call_324db9b6027041bf8ac524', 'type': 'function'}], 'content': ''}}]}, 'usage': {'total_tokens': 238, 'output_tokens': 13, 'input_tokens': 225, 'prompt_tokens_details': {'cached_tokens': 0}}, 'request_id': 'b826f746-184b-906d-87dd-477206c8d476'}
2025-06-08 09:52:11,547 - gongdi-api.dashscope - DEBUG - DashScope API响应状态码: 200
2025-06-08 09:52:11,547 - gongdi-api.dashscope - DEBUG - 成功处理响应: request_id=b826f746-184b-906d-87dd-477206c8d476
2025-06-08 09:52:11,548 - gongdi-api - DEBUG - API响应: {'status_code': <HTTPStatus.OK: 200>, 'request_id': 'b826f746-184b-906d-87dd-477206c8d476', 'choices': [{'message': Message({'role': 'assistant', 'content': '', 'tool_calls': [{'function': {'name': 'get_current_time', 'arguments': '{}'}, 'index': 0, 'id': 'call_324db9b6027041bf8ac524', 'type': 'function'}]})}], 'usage': {}}
2025-06-08 09:52:11,549 - gongdi-api - DEBUG - 工具调用信息: {'id': 'call_324db9b6027041bf8ac524', 'function_name': 'get_current_time', 'arguments': {}}
2025-06-08 09:52:11,550 - gongdi-api - DEBUG - 最终返回结果: {'status_code': <HTTPStatus.OK: 200>, 'request_id': 'b826f746-184b-906d-87dd-477206c8d476', 'message': Message({'role': 'assistant', 'content': '', 'tool_calls': [{'function': {'name': 'get_current_time', 'arguments': '{}'}, 'index': 0, 'id': 'call_324db9b6027041bf8ac524', 'type': 'function'}]}), 'tool_calls': [{'id': 'call_324db9b6027041bf8ac524', 'function_name': 'get_current_time', 'arguments': {}}]}
2025-06-08 09:52:11,589 - gongdi-api - DEBUG - 接收到函数调用请求: {'query': '杭州的天气怎么样？', 'tools': None}
2025-06-08 09:52:11,590 - gongdi-api - DEBUG - 使用默认工具: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 09:52:11,591 - gongdi-api - DEBUG - 调用DashscopeClient处理请求，query: 杭州的天气怎么样？
2025-06-08 09:52:11,592 - gongdi-api.dashscope - DEBUG - DashscopeClient初始化: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 09:52:11,594 - gongdi-api.dashscope - DEBUG - 接收function_call请求: messages=[{'role': 'user', 'content': '杭州的天气怎么样？'}]
2025-06-08 09:52:11,595 - gongdi-api.dashscope - DEBUG - 原始工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 09:52:11,598 - gongdi-api.dashscope - DEBUG - 格式化后的工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 09:52:11,600 - gongdi-api.dashscope - DEBUG - 调用DashScope API参数: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 09:52:11,601 - gongdi-api.dashscope - DEBUG - 开始调用DashScope API...
2025-06-08 09:52:11,602 - dashscope - DEBUG - Request body: {'model': 'qwen-turbo', 'parameters': {'tools': [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}], 'temperature': 0, 'max_tokens': 2048, 'result_format': 'message'}, 'input': {'messages': [{'role': 'user', 'content': '杭州的天气怎么样？'}]}}
2025-06-08 09:52:11,611 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): dashscope.aliyuncs.com:443
2025-06-08 09:52:13,904 - urllib3.connectionpool - DEBUG - https://dashscope.aliyuncs.com:443 "POST /api/v1/services/aigc/text-generation/generation HTTP/1.1" 200 None
2025-06-08 09:52:13,906 - dashscope - DEBUG - Response: {'output': {'choices': [{'finish_reason': 'tool_calls', 'message': {'role': 'assistant', 'tool_calls': [{'function': {'name': 'get_current_weather', 'arguments': '{"location": "杭州市"}'}, 'index': 0, 'id': 'call_0d5952f3c25b40eab51afa', 'type': 'function'}], 'content': ''}}]}, 'usage': {'total_tokens': 244, 'output_tokens': 18, 'input_tokens': 226, 'prompt_tokens_details': {'cached_tokens': 0}}, 'request_id': '3d156ed1-2305-9083-8b98-fbe7f9e28638'}
2025-06-08 09:52:13,912 - gongdi-api.dashscope - DEBUG - DashScope API响应状态码: 200
2025-06-08 09:52:13,913 - gongdi-api.dashscope - DEBUG - 成功处理响应: request_id=3d156ed1-2305-9083-8b98-fbe7f9e28638
2025-06-08 09:52:13,914 - gongdi-api - DEBUG - API响应: {'status_code': <HTTPStatus.OK: 200>, 'request_id': '3d156ed1-2305-9083-8b98-fbe7f9e28638', 'choices': [{'message': Message({'role': 'assistant', 'content': '', 'tool_calls': [{'function': {'name': 'get_current_weather', 'arguments': '{"location": "杭州市"}'}, 'index': 0, 'id': 'call_0d5952f3c25b40eab51afa', 'type': 'function'}]})}], 'usage': {}}
2025-06-08 09:52:13,915 - gongdi-api - DEBUG - 工具调用信息: {'id': 'call_0d5952f3c25b40eab51afa', 'function_name': 'get_current_weather', 'arguments': {'location': '杭州市'}}
2025-06-08 09:52:13,916 - gongdi-api - DEBUG - 最终返回结果: {'status_code': <HTTPStatus.OK: 200>, 'request_id': '3d156ed1-2305-9083-8b98-fbe7f9e28638', 'message': Message({'role': 'assistant', 'content': '', 'tool_calls': [{'function': {'name': 'get_current_weather', 'arguments': '{"location": "杭州市"}'}, 'index': 0, 'id': 'call_0d5952f3c25b40eab51afa', 'type': 'function'}]}), 'tool_calls': [{'id': 'call_0d5952f3c25b40eab51afa', 'function_name': 'get_current_weather', 'arguments': {'location': '杭州市'}}]}
2025-06-08 09:52:13,939 - gongdi-api.dashscope - DEBUG - DashscopeClient初始化: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 09:52:13,940 - gongdi-api.dashscope - DEBUG - 接收function_call请求: messages=[{'role': 'user', 'content': '北京现在几点了？天气怎么样？'}]
2025-06-08 09:52:13,941 - gongdi-api.dashscope - DEBUG - 原始工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 09:52:13,942 - gongdi-api.dashscope - DEBUG - 格式化后的工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 09:52:13,944 - gongdi-api.dashscope - DEBUG - 调用DashScope API参数: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 09:52:13,945 - gongdi-api.dashscope - DEBUG - 开始调用DashScope API...
2025-06-08 09:52:13,946 - dashscope - DEBUG - Request body: {'model': 'qwen-turbo', 'parameters': {'tools': [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}], 'temperature': 0, 'max_tokens': 2048, 'result_format': 'message'}, 'input': {'messages': [{'role': 'user', 'content': '北京现在几点了？天气怎么样？'}]}}
2025-06-08 09:52:13,951 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): dashscope.aliyuncs.com:443
2025-06-08 09:52:16,331 - urllib3.connectionpool - DEBUG - https://dashscope.aliyuncs.com:443 "POST /api/v1/services/aigc/text-generation/generation HTTP/1.1" 200 None
2025-06-08 09:52:16,335 - dashscope - DEBUG - Response: {'output': {'choices': [{'finish_reason': 'tool_calls', 'message': {'role': 'assistant', 'tool_calls': [{'function': {'name': 'get_current_time', 'arguments': '{}'}, 'index': 0, 'id': 'call_d3d6020e591f41afa65c01', 'type': 'function'}], 'content': ''}}]}, 'usage': {'total_tokens': 242, 'output_tokens': 13, 'input_tokens': 229, 'prompt_tokens_details': {'cached_tokens': 0}}, 'request_id': '4283bf28-065b-99ea-b9d1-b5df5b5b6653'}
2025-06-08 09:52:16,341 - gongdi-api.dashscope - DEBUG - DashScope API响应状态码: 200
2025-06-08 09:52:16,343 - gongdi-api.dashscope - DEBUG - 成功处理响应: request_id=4283bf28-065b-99ea-b9d1-b5df5b5b6653
2025-06-08 09:52:16,343 - gongdi-api.dashscope - DEBUG - DashscopeClient初始化: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 09:52:16,344 - dashscope - DEBUG - Request body: {'model': 'qwen-turbo', 'parameters': {'temperature': 0, 'max_tokens': 2048, 'result_format': 'message'}, 'input': {'messages': [{'role': 'user', 'content': '北京现在几点了？天气怎么样？'}, {'role': 'assistant', 'content': '', 'tool_calls': [{'function': {'name': 'get_current_time', 'arguments': '{}'}, 'index': 0, 'id': 'call_d3d6020e591f41afa65c01', 'type': 'function'}]}, {'tool_call_id': 'call_d3d6020e591f41afa65c01', 'role': 'tool', 'content': '{"datetime": "2025-06-08 09:52:16", "date": "2025-06-08", "time": "09:52:16", "weekday": "Sunday"}'}]}}
2025-06-08 09:52:16,349 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): dashscope.aliyuncs.com:443
2025-06-08 09:52:19,420 - urllib3.connectionpool - DEBUG - https://dashscope.aliyuncs.com:443 "POST /api/v1/services/aigc/text-generation/generation HTTP/1.1" 200 None
2025-06-08 09:52:19,423 - dashscope - DEBUG - Response: {'output': {'choices': [{'finish_reason': 'stop', 'message': {'role': 'assistant', 'content': '根据提供的信息，北京当前时间是 **2025年6月8日 星期日 09:52:16**。\n\n关于天气情况，由于你没有提供具体的天气数据，我无法直接告知当前的天气状况。不过，如果你需要查询实时天气，可以通过天气预报网站或相关应用程序获取最新的北京天气信息。'}}]}, 'usage': {'total_tokens': 160, 'output_tokens': 75, 'input_tokens': 85, 'prompt_tokens_details': {'cached_tokens': 0}}, 'request_id': '2d96d04a-cd6d-93df-beb7-4ff17ad520ac'}
2025-06-08 09:52:56,698 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:52:56,751 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:52:57,016 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:52:57,142 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:52:57,746 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:52:59,533 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:53:00,959 - gongdi-api - DEBUG - 接收到函数调用请求: {'query': '现在几点了？', 'tools': None}
2025-06-08 09:53:00,960 - gongdi-api - DEBUG - 使用默认工具: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 09:53:00,961 - gongdi-api - DEBUG - 调用DashscopeClient处理请求，query: 现在几点了？
2025-06-08 09:53:00,962 - gongdi-api.dashscope - DEBUG - DashscopeClient初始化: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 09:53:00,962 - gongdi-api.dashscope - DEBUG - 接收function_call请求: messages=[{'role': 'user', 'content': '现在几点了？'}]
2025-06-08 09:53:00,963 - gongdi-api.dashscope - DEBUG - 原始工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 09:53:00,965 - gongdi-api.dashscope - DEBUG - 格式化后的工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 09:53:00,966 - gongdi-api.dashscope - DEBUG - 调用DashScope API参数: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 09:53:00,967 - gongdi-api.dashscope - DEBUG - 开始调用DashScope API...
2025-06-08 09:53:01,165 - dashscope - DEBUG - Request body: {'model': 'qwen-turbo', 'parameters': {'tools': [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}], 'temperature': 0, 'max_tokens': 2048, 'result_format': 'message'}, 'input': {'messages': [{'role': 'user', 'content': '现在几点了？'}]}}
2025-06-08 09:53:01,182 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): dashscope.aliyuncs.com:443
2025-06-08 09:53:03,365 - urllib3.connectionpool - DEBUG - https://dashscope.aliyuncs.com:443 "POST /api/v1/services/aigc/text-generation/generation HTTP/1.1" 200 None
2025-06-08 09:53:03,367 - dashscope - DEBUG - Response: {'output': {'choices': [{'finish_reason': 'tool_calls', 'message': {'role': 'assistant', 'tool_calls': [{'function': {'name': 'get_current_time', 'arguments': '{}'}, 'index': 0, 'id': 'call_5cf2de9edec84bb7960aee', 'type': 'function'}], 'content': ''}}]}, 'usage': {'total_tokens': 238, 'output_tokens': 13, 'input_tokens': 225, 'prompt_tokens_details': {'cached_tokens': 0}}, 'request_id': 'b09cafb3-aa80-9a84-abe6-cdb0e4c9e260'}
2025-06-08 09:53:03,372 - gongdi-api.dashscope - DEBUG - DashScope API响应状态码: 200
2025-06-08 09:53:03,373 - gongdi-api.dashscope - DEBUG - 成功处理响应: request_id=b09cafb3-aa80-9a84-abe6-cdb0e4c9e260
2025-06-08 09:53:03,374 - gongdi-api - DEBUG - API响应: {'status_code': <HTTPStatus.OK: 200>, 'request_id': 'b09cafb3-aa80-9a84-abe6-cdb0e4c9e260', 'choices': [{'message': Message({'role': 'assistant', 'content': '', 'tool_calls': [{'function': {'name': 'get_current_time', 'arguments': '{}'}, 'index': 0, 'id': 'call_5cf2de9edec84bb7960aee', 'type': 'function'}]})}], 'usage': {}}
2025-06-08 09:53:03,375 - gongdi-api - DEBUG - 工具调用信息: {'id': 'call_5cf2de9edec84bb7960aee', 'function_name': 'get_current_time', 'arguments': {}}
2025-06-08 09:53:03,375 - gongdi-api - DEBUG - 最终返回结果: {'status_code': <HTTPStatus.OK: 200>, 'request_id': 'b09cafb3-aa80-9a84-abe6-cdb0e4c9e260', 'message': Message({'role': 'assistant', 'content': '', 'tool_calls': [{'function': {'name': 'get_current_time', 'arguments': '{}'}, 'index': 0, 'id': 'call_5cf2de9edec84bb7960aee', 'type': 'function'}]}), 'tool_calls': [{'id': 'call_5cf2de9edec84bb7960aee', 'function_name': 'get_current_time', 'arguments': {}}]}
2025-06-08 09:53:03,409 - gongdi-api - DEBUG - 接收到函数调用请求: {'query': '杭州的天气怎么样？', 'tools': None}
2025-06-08 09:53:03,409 - gongdi-api - DEBUG - 使用默认工具: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 09:53:03,411 - gongdi-api - DEBUG - 调用DashscopeClient处理请求，query: 杭州的天气怎么样？
2025-06-08 09:53:03,412 - gongdi-api.dashscope - DEBUG - DashscopeClient初始化: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 09:53:03,412 - gongdi-api.dashscope - DEBUG - 接收function_call请求: messages=[{'role': 'user', 'content': '杭州的天气怎么样？'}]
2025-06-08 09:53:03,413 - gongdi-api.dashscope - DEBUG - 原始工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 09:53:03,414 - gongdi-api.dashscope - DEBUG - 格式化后的工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 09:53:03,415 - gongdi-api.dashscope - DEBUG - 调用DashScope API参数: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 09:53:03,416 - gongdi-api.dashscope - DEBUG - 开始调用DashScope API...
2025-06-08 09:53:03,417 - dashscope - DEBUG - Request body: {'model': 'qwen-turbo', 'parameters': {'tools': [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}], 'temperature': 0, 'max_tokens': 2048, 'result_format': 'message'}, 'input': {'messages': [{'role': 'user', 'content': '杭州的天气怎么样？'}]}}
2025-06-08 09:53:03,421 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): dashscope.aliyuncs.com:443
2025-06-08 09:53:05,753 - urllib3.connectionpool - DEBUG - https://dashscope.aliyuncs.com:443 "POST /api/v1/services/aigc/text-generation/generation HTTP/1.1" 200 None
2025-06-08 09:53:05,755 - dashscope - DEBUG - Response: {'output': {'choices': [{'finish_reason': 'tool_calls', 'message': {'role': 'assistant', 'tool_calls': [{'function': {'name': 'get_current_weather', 'arguments': '{"location": "杭州市"}'}, 'index': 0, 'id': 'call_6f1086eb2f064b47b67913', 'type': 'function'}], 'content': ''}}]}, 'usage': {'total_tokens': 244, 'output_tokens': 18, 'input_tokens': 226, 'prompt_tokens_details': {'cached_tokens': 128}}, 'request_id': '77d14441-8b31-958a-b282-3bac69060908'}
2025-06-08 09:53:05,762 - gongdi-api.dashscope - DEBUG - DashScope API响应状态码: 200
2025-06-08 09:53:05,762 - gongdi-api.dashscope - DEBUG - 成功处理响应: request_id=77d14441-8b31-958a-b282-3bac69060908
2025-06-08 09:53:05,763 - gongdi-api - DEBUG - API响应: {'status_code': <HTTPStatus.OK: 200>, 'request_id': '77d14441-8b31-958a-b282-3bac69060908', 'choices': [{'message': Message({'role': 'assistant', 'content': '', 'tool_calls': [{'function': {'name': 'get_current_weather', 'arguments': '{"location": "杭州市"}'}, 'index': 0, 'id': 'call_6f1086eb2f064b47b67913', 'type': 'function'}]})}], 'usage': {}}
2025-06-08 09:53:05,764 - gongdi-api - DEBUG - 工具调用信息: {'id': 'call_6f1086eb2f064b47b67913', 'function_name': 'get_current_weather', 'arguments': {'location': '杭州市'}}
2025-06-08 09:53:05,765 - gongdi-api - DEBUG - 最终返回结果: {'status_code': <HTTPStatus.OK: 200>, 'request_id': '77d14441-8b31-958a-b282-3bac69060908', 'message': Message({'role': 'assistant', 'content': '', 'tool_calls': [{'function': {'name': 'get_current_weather', 'arguments': '{"location": "杭州市"}'}, 'index': 0, 'id': 'call_6f1086eb2f064b47b67913', 'type': 'function'}]}), 'tool_calls': [{'id': 'call_6f1086eb2f064b47b67913', 'function_name': 'get_current_weather', 'arguments': {'location': '杭州市'}}]}
2025-06-08 09:53:05,792 - gongdi-api.dashscope - DEBUG - DashscopeClient初始化: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 09:53:05,792 - gongdi-api.dashscope - DEBUG - 接收function_call请求: messages=[{'role': 'user', 'content': '北京现在几点了？天气怎么样？'}]
2025-06-08 09:53:05,793 - gongdi-api.dashscope - DEBUG - 原始工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 09:53:05,795 - gongdi-api.dashscope - DEBUG - 格式化后的工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 09:53:05,796 - gongdi-api.dashscope - DEBUG - 调用DashScope API参数: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 09:53:05,796 - gongdi-api.dashscope - DEBUG - 开始调用DashScope API...
2025-06-08 09:53:05,797 - dashscope - DEBUG - Request body: {'model': 'qwen-turbo', 'parameters': {'tools': [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}], 'temperature': 0, 'max_tokens': 2048, 'result_format': 'message'}, 'input': {'messages': [{'role': 'user', 'content': '北京现在几点了？天气怎么样？'}]}}
2025-06-08 09:53:05,802 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): dashscope.aliyuncs.com:443
2025-06-08 09:53:08,062 - urllib3.connectionpool - DEBUG - https://dashscope.aliyuncs.com:443 "POST /api/v1/services/aigc/text-generation/generation HTTP/1.1" 200 None
2025-06-08 09:53:08,064 - dashscope - DEBUG - Response: {'output': {'choices': [{'finish_reason': 'tool_calls', 'message': {'role': 'assistant', 'tool_calls': [{'function': {'name': 'get_current_time', 'arguments': '{}'}, 'index': 0, 'id': 'call_58cb0213dbd74adea3a4d8', 'type': 'function'}], 'content': ''}}]}, 'usage': {'total_tokens': 242, 'output_tokens': 13, 'input_tokens': 229, 'prompt_tokens_details': {'cached_tokens': 0}}, 'request_id': '8cc6d504-8d80-9dee-8a29-46ffc0a2dc47'}
2025-06-08 09:53:08,070 - gongdi-api.dashscope - DEBUG - DashScope API响应状态码: 200
2025-06-08 09:53:08,071 - gongdi-api.dashscope - DEBUG - 成功处理响应: request_id=8cc6d504-8d80-9dee-8a29-46ffc0a2dc47
2025-06-08 09:53:08,071 - gongdi-api.dashscope - DEBUG - DashscopeClient初始化: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 09:53:08,072 - dashscope - DEBUG - Request body: {'model': 'qwen-turbo', 'parameters': {'temperature': 0, 'max_tokens': 2048, 'result_format': 'message'}, 'input': {'messages': [{'role': 'user', 'content': '北京现在几点了？天气怎么样？'}, {'role': 'assistant', 'content': '', 'tool_calls': [{'function': {'name': 'get_current_time', 'arguments': '{}'}, 'index': 0, 'id': 'call_58cb0213dbd74adea3a4d8', 'type': 'function'}]}, {'tool_call_id': 'call_58cb0213dbd74adea3a4d8', 'role': 'tool', 'content': '{"datetime": "2025-06-08 09:53:08", "date": "2025-06-08", "time": "09:53:08", "weekday": "Sunday"}'}]}}
2025-06-08 09:53:08,076 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): dashscope.aliyuncs.com:443
2025-06-08 09:53:11,119 - urllib3.connectionpool - DEBUG - https://dashscope.aliyuncs.com:443 "POST /api/v1/services/aigc/text-generation/generation HTTP/1.1" 200 None
2025-06-08 09:53:11,121 - dashscope - DEBUG - Response: {'output': {'choices': [{'finish_reason': 'stop', 'message': {'role': 'assistant', 'content': '根据提供的信息，北京当前时间是 **2025年6月8日 星期日 09:53:08**。\n\n关于天气情况，由于你没有提供具体的天气数据，我无法直接告知当前的天气状况。不过，如果你需要查询实时天气，可以通过天气预报网站或相关应用程序获取最新的北京天气信息。'}}]}, 'usage': {'total_tokens': 160, 'output_tokens': 75, 'input_tokens': 85, 'prompt_tokens_details': {'cached_tokens': 0}}, 'request_id': '39ebafef-78e9-9b92-9554-ab5bdb2bd66c'}
2025-06-08 09:53:35,621 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:53:36,589 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:53:37,645 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:53:37,824 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:53:37,857 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:53:38,754 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:53:42,010 - gongdi-api - DEBUG - 接收到函数调用请求: {'query': '现在几点了？', 'tools': None}
2025-06-08 09:53:42,010 - gongdi-api - DEBUG - 使用默认工具: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 09:53:42,012 - gongdi-api - DEBUG - 使用测试模式处理请求
2025-06-08 09:53:42,012 - gongdi-api - ERROR - 函数调用请求失败: name 'mock_function_call' is not defined
2025-06-08 09:53:42,024 - gongdi-api - ERROR - Traceback (most recent call last):
  File "C:\code\gongdi4\app.py", line 264, in function_call
    response = mock_function_call(request.query, tools)
               ^^^^^^^^^^^^^^^^^^
NameError: name 'mock_function_call' is not defined. Did you mean: 'function_call'?

2025-06-08 09:53:42,036 - gongdi-api - DEBUG - 接收到函数调用请求: {'query': '杭州的天气怎么样？', 'tools': None}
2025-06-08 09:53:42,037 - gongdi-api - DEBUG - 使用默认工具: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 09:53:42,038 - gongdi-api - DEBUG - 使用测试模式处理请求
2025-06-08 09:53:42,039 - gongdi-api - ERROR - 函数调用请求失败: name 'mock_function_call' is not defined
2025-06-08 09:53:42,049 - gongdi-api - ERROR - Traceback (most recent call last):
  File "C:\code\gongdi4\app.py", line 264, in function_call
    response = mock_function_call(request.query, tools)
               ^^^^^^^^^^^^^^^^^^
NameError: name 'mock_function_call' is not defined. Did you mean: 'function_call'?

2025-06-08 09:54:05,914 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:54:07,006 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:54:07,138 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:54:07,457 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:54:07,566 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:54:07,935 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:54:09,424 - gongdi-api - DEBUG - 接收到函数调用请求: {'query': '现在几点了？', 'tools': None}
2025-06-08 09:54:09,425 - gongdi-api - DEBUG - 使用默认工具: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 09:54:09,426 - gongdi-api - DEBUG - 调用DashscopeClient处理请求，query: 现在几点了？
2025-06-08 09:54:09,426 - gongdi-api.dashscope - DEBUG - DashscopeClient初始化: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 09:54:09,427 - gongdi-api.dashscope - DEBUG - 接收function_call请求: messages=[{'role': 'user', 'content': '现在几点了？'}]
2025-06-08 09:54:09,428 - gongdi-api.dashscope - DEBUG - 原始工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 09:54:09,429 - gongdi-api.dashscope - DEBUG - 格式化后的工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 09:54:09,430 - gongdi-api.dashscope - DEBUG - 调用DashScope API参数: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 09:54:09,431 - gongdi-api.dashscope - DEBUG - 开始调用DashScope API...
2025-06-08 09:54:09,879 - dashscope - DEBUG - Request body: {'model': 'qwen-turbo', 'parameters': {'tools': [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}], 'temperature': 0, 'max_tokens': 2048, 'result_format': 'message'}, 'input': {'messages': [{'role': 'user', 'content': '现在几点了？'}]}}
2025-06-08 09:54:09,903 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): dashscope.aliyuncs.com:443
2025-06-08 09:54:12,161 - urllib3.connectionpool - DEBUG - https://dashscope.aliyuncs.com:443 "POST /api/v1/services/aigc/text-generation/generation HTTP/1.1" 200 None
2025-06-08 09:54:12,163 - dashscope - DEBUG - Response: {'output': {'choices': [{'finish_reason': 'tool_calls', 'message': {'role': 'assistant', 'tool_calls': [{'function': {'name': 'get_current_time', 'arguments': '{}'}, 'index': 0, 'id': 'call_e3a1db993f0f4e148885f2', 'type': 'function'}], 'content': ''}}]}, 'usage': {'total_tokens': 238, 'output_tokens': 13, 'input_tokens': 225, 'prompt_tokens_details': {'cached_tokens': 128}}, 'request_id': '2c457e80-7d63-9a70-b806-cd3012eac9b4'}
2025-06-08 09:54:12,169 - gongdi-api.dashscope - DEBUG - DashScope API响应状态码: 200
2025-06-08 09:54:12,170 - gongdi-api.dashscope - DEBUG - 成功处理响应: request_id=2c457e80-7d63-9a70-b806-cd3012eac9b4
2025-06-08 09:54:12,170 - gongdi-api - DEBUG - API响应: {'status_code': <HTTPStatus.OK: 200>, 'request_id': '2c457e80-7d63-9a70-b806-cd3012eac9b4', 'choices': [{'message': Message({'role': 'assistant', 'content': '', 'tool_calls': [{'function': {'name': 'get_current_time', 'arguments': '{}'}, 'index': 0, 'id': 'call_e3a1db993f0f4e148885f2', 'type': 'function'}]})}], 'usage': {}}
2025-06-08 09:54:12,171 - gongdi-api - DEBUG - 工具调用信息: {'id': 'call_e3a1db993f0f4e148885f2', 'function_name': 'get_current_time', 'arguments': {}}
2025-06-08 09:54:12,173 - gongdi-api - DEBUG - 最终返回结果: {'status_code': <HTTPStatus.OK: 200>, 'request_id': '2c457e80-7d63-9a70-b806-cd3012eac9b4', 'message': Message({'role': 'assistant', 'content': '', 'tool_calls': [{'function': {'name': 'get_current_time', 'arguments': '{}'}, 'index': 0, 'id': 'call_e3a1db993f0f4e148885f2', 'type': 'function'}]}), 'tool_calls': [{'id': 'call_e3a1db993f0f4e148885f2', 'function_name': 'get_current_time', 'arguments': {}}]}
2025-06-08 09:54:12,208 - gongdi-api - DEBUG - 接收到函数调用请求: {'query': '杭州的天气怎么样？', 'tools': None}
2025-06-08 09:54:12,209 - gongdi-api - DEBUG - 使用默认工具: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 09:54:12,210 - gongdi-api - DEBUG - 调用DashscopeClient处理请求，query: 杭州的天气怎么样？
2025-06-08 09:54:12,210 - gongdi-api.dashscope - DEBUG - DashscopeClient初始化: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 09:54:12,211 - gongdi-api.dashscope - DEBUG - 接收function_call请求: messages=[{'role': 'user', 'content': '杭州的天气怎么样？'}]
2025-06-08 09:54:12,212 - gongdi-api.dashscope - DEBUG - 原始工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 09:54:12,217 - gongdi-api.dashscope - DEBUG - 格式化后的工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 09:54:12,218 - gongdi-api.dashscope - DEBUG - 调用DashScope API参数: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 09:54:12,219 - gongdi-api.dashscope - DEBUG - 开始调用DashScope API...
2025-06-08 09:54:12,220 - dashscope - DEBUG - Request body: {'model': 'qwen-turbo', 'parameters': {'tools': [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}], 'temperature': 0, 'max_tokens': 2048, 'result_format': 'message'}, 'input': {'messages': [{'role': 'user', 'content': '杭州的天气怎么样？'}]}}
2025-06-08 09:54:12,225 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): dashscope.aliyuncs.com:443
2025-06-08 09:54:14,571 - urllib3.connectionpool - DEBUG - https://dashscope.aliyuncs.com:443 "POST /api/v1/services/aigc/text-generation/generation HTTP/1.1" 200 None
2025-06-08 09:54:14,573 - dashscope - DEBUG - Response: {'output': {'choices': [{'finish_reason': 'tool_calls', 'message': {'role': 'assistant', 'tool_calls': [{'function': {'name': 'get_current_weather', 'arguments': '{"location": "杭州市"}'}, 'index': 0, 'id': 'call_07111583b718423ebe2a4f', 'type': 'function'}], 'content': ''}}]}, 'usage': {'total_tokens': 244, 'output_tokens': 18, 'input_tokens': 226, 'prompt_tokens_details': {'cached_tokens': 0}}, 'request_id': '02fad67a-d4ba-9c57-8f02-bfb836d204be'}
2025-06-08 09:54:14,577 - gongdi-api.dashscope - DEBUG - DashScope API响应状态码: 200
2025-06-08 09:54:14,577 - gongdi-api.dashscope - DEBUG - 成功处理响应: request_id=02fad67a-d4ba-9c57-8f02-bfb836d204be
2025-06-08 09:54:14,578 - gongdi-api - DEBUG - API响应: {'status_code': <HTTPStatus.OK: 200>, 'request_id': '02fad67a-d4ba-9c57-8f02-bfb836d204be', 'choices': [{'message': Message({'role': 'assistant', 'content': '', 'tool_calls': [{'function': {'name': 'get_current_weather', 'arguments': '{"location": "杭州市"}'}, 'index': 0, 'id': 'call_07111583b718423ebe2a4f', 'type': 'function'}]})}], 'usage': {}}
2025-06-08 09:54:14,579 - gongdi-api - DEBUG - 工具调用信息: {'id': 'call_07111583b718423ebe2a4f', 'function_name': 'get_current_weather', 'arguments': {'location': '杭州市'}}
2025-06-08 09:54:14,580 - gongdi-api - DEBUG - 最终返回结果: {'status_code': <HTTPStatus.OK: 200>, 'request_id': '02fad67a-d4ba-9c57-8f02-bfb836d204be', 'message': Message({'role': 'assistant', 'content': '', 'tool_calls': [{'function': {'name': 'get_current_weather', 'arguments': '{"location": "杭州市"}'}, 'index': 0, 'id': 'call_07111583b718423ebe2a4f', 'type': 'function'}]}), 'tool_calls': [{'id': 'call_07111583b718423ebe2a4f', 'function_name': 'get_current_weather', 'arguments': {'location': '杭州市'}}]}
2025-06-08 09:54:14,601 - gongdi-api.dashscope - DEBUG - DashscopeClient初始化: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 09:54:14,602 - gongdi-api.dashscope - DEBUG - 接收function_call请求: messages=[{'role': 'user', 'content': '北京现在几点了？天气怎么样？'}]
2025-06-08 09:54:14,603 - gongdi-api.dashscope - DEBUG - 原始工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 09:54:14,605 - gongdi-api.dashscope - DEBUG - 格式化后的工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 09:54:14,606 - gongdi-api.dashscope - DEBUG - 调用DashScope API参数: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 09:54:14,606 - gongdi-api.dashscope - DEBUG - 开始调用DashScope API...
2025-06-08 09:54:14,607 - dashscope - DEBUG - Request body: {'model': 'qwen-turbo', 'parameters': {'tools': [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}], 'temperature': 0, 'max_tokens': 2048, 'result_format': 'message'}, 'input': {'messages': [{'role': 'user', 'content': '北京现在几点了？天气怎么样？'}]}}
2025-06-08 09:54:14,612 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): dashscope.aliyuncs.com:443
2025-06-08 09:54:16,826 - urllib3.connectionpool - DEBUG - https://dashscope.aliyuncs.com:443 "POST /api/v1/services/aigc/text-generation/generation HTTP/1.1" 200 None
2025-06-08 09:54:16,828 - dashscope - DEBUG - Response: {'output': {'choices': [{'finish_reason': 'tool_calls', 'message': {'role': 'assistant', 'tool_calls': [{'function': {'name': 'get_current_time', 'arguments': '{}'}, 'index': 0, 'id': 'call_867f858419fe4b93831e4a', 'type': 'function'}], 'content': ''}}]}, 'usage': {'total_tokens': 242, 'output_tokens': 13, 'input_tokens': 229, 'prompt_tokens_details': {'cached_tokens': 128}}, 'request_id': '2778ee74-c711-9e7e-9081-23a3857fd15e'}
2025-06-08 09:54:16,837 - gongdi-api.dashscope - DEBUG - DashScope API响应状态码: 200
2025-06-08 09:54:16,838 - gongdi-api.dashscope - DEBUG - 成功处理响应: request_id=2778ee74-c711-9e7e-9081-23a3857fd15e
2025-06-08 09:54:16,839 - gongdi-api.dashscope - DEBUG - DashscopeClient初始化: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 09:54:16,840 - dashscope - DEBUG - Request body: {'model': 'qwen-turbo', 'parameters': {'temperature': 0, 'max_tokens': 2048, 'result_format': 'message'}, 'input': {'messages': [{'role': 'user', 'content': '北京现在几点了？天气怎么样？'}, {'role': 'assistant', 'content': '', 'tool_calls': [{'function': {'name': 'get_current_time', 'arguments': '{}'}, 'index': 0, 'id': 'call_867f858419fe4b93831e4a', 'type': 'function'}]}, {'tool_call_id': 'call_867f858419fe4b93831e4a', 'role': 'tool', 'content': '{"datetime": "2025-06-08 09:54:16", "date": "2025-06-08", "time": "09:54:16", "weekday": "Sunday"}'}]}}
2025-06-08 09:54:16,843 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): dashscope.aliyuncs.com:443
2025-06-08 09:54:19,663 - urllib3.connectionpool - DEBUG - https://dashscope.aliyuncs.com:443 "POST /api/v1/services/aigc/text-generation/generation HTTP/1.1" 200 None
2025-06-08 09:54:19,665 - dashscope - DEBUG - Response: {'output': {'choices': [{'finish_reason': 'stop', 'message': {'role': 'assistant', 'content': '根据提供的信息，北京当前时间是 **2025年6月8日 星期日 09:54:16**。\n\n关于天气情况，由于您没有提供具体的天气数据，我无法直接告诉您当前的天气状况。不过，如果您需要查询实时天气，可以通过天气预报网站或相关应用程序获取最新的北京天气信息。'}}]}, 'usage': {'total_tokens': 161, 'output_tokens': 76, 'input_tokens': 85, 'prompt_tokens_details': {'cached_tokens': 0}}, 'request_id': 'b8df6874-f0f1-9392-858a-c38985e55383'}
2025-06-08 09:54:49,537 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:54:51,296 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:54:51,377 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:54:51,510 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:54:51,593 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:54:51,738 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:54:53,094 - gongdi-api - DEBUG - 接收到函数调用请求: {'query': '现在几点了？', 'tools': None}
2025-06-08 09:54:53,095 - gongdi-api - DEBUG - 使用默认工具: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 09:54:53,096 - gongdi-api - DEBUG - 使用测试模式处理请求
2025-06-08 09:54:53,097 - gongdi-api - ERROR - 函数调用请求失败: name 'mock_function_call' is not defined
2025-06-08 09:54:53,108 - gongdi-api - ERROR - Traceback (most recent call last):
  File "C:\code\gongdi4\app.py", line 264, in function_call
    response = mock_function_call(request.query, tools)
               ^^^^^^^^^^^^^^^^^^
NameError: name 'mock_function_call' is not defined. Did you mean: 'function_call'?

2025-06-08 09:55:27,244 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:55:27,996 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:55:28,284 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:55:29,216 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:55:30,294 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:55:30,575 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:55:46,881 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:55:48,371 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:55:49,070 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:55:49,152 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:58:05,940 - gongdi-api - DEBUG - 接收到函数调用请求: {'query': '现在几点了？', 'tools': None}
2025-06-08 09:58:05,941 - gongdi-api - DEBUG - 使用默认工具: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 09:58:05,942 - gongdi-api - DEBUG - 使用测试模式处理请求
2025-06-08 09:58:05,942 - gongdi-api - DEBUG - API响应: {'status_code': <HTTPStatus.OK: 200>, 'request_id': 'mock-func-12345', 'choices': [{'message': {'role': 'assistant', 'content': '', 'tool_calls': [{'id': 'mock-call-12345', 'type': 'function', 'function': {'name': 'get_current_time', 'arguments': '{}'}}]}}]}
2025-06-08 09:58:05,943 - gongdi-api - DEBUG - 工具调用信息: {'id': 'mock-call-12345', 'function_name': 'get_current_time', 'arguments': {}}
2025-06-08 09:58:05,944 - gongdi-api - DEBUG - 最终返回结果: {'status_code': <HTTPStatus.OK: 200>, 'request_id': 'mock-func-12345', 'message': {'role': 'assistant', 'content': '', 'tool_calls': [{'id': 'mock-call-12345', 'type': 'function', 'function': {'name': 'get_current_time', 'arguments': '{}'}}]}, 'tool_calls': [{'id': 'mock-call-12345', 'function_name': 'get_current_time', 'arguments': {}}]}
2025-06-08 09:58:10,511 - gongdi-api - DEBUG - 接收到函数调用请求: {'query': '现在几点了？', 'tools': None}
2025-06-08 09:58:10,512 - gongdi-api - DEBUG - 使用默认工具: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 09:58:10,513 - gongdi-api - DEBUG - 使用测试模式处理请求
2025-06-08 09:58:10,514 - gongdi-api - DEBUG - API响应: {'status_code': <HTTPStatus.OK: 200>, 'request_id': 'mock-func-12345', 'choices': [{'message': {'role': 'assistant', 'content': '', 'tool_calls': [{'id': 'mock-call-12345', 'type': 'function', 'function': {'name': 'get_current_time', 'arguments': '{}'}}]}}]}
2025-06-08 09:58:10,515 - gongdi-api - DEBUG - 工具调用信息: {'id': 'mock-call-12345', 'function_name': 'get_current_time', 'arguments': {}}
2025-06-08 09:58:10,516 - gongdi-api - DEBUG - 最终返回结果: {'status_code': <HTTPStatus.OK: 200>, 'request_id': 'mock-func-12345', 'message': {'role': 'assistant', 'content': '', 'tool_calls': [{'id': 'mock-call-12345', 'type': 'function', 'function': {'name': 'get_current_time', 'arguments': '{}'}}]}, 'tool_calls': [{'id': 'mock-call-12345', 'function_name': 'get_current_time', 'arguments': {}}]}
2025-06-08 09:58:10,533 - gongdi-api - DEBUG - 接收到函数调用请求: {'query': '杭州的天气怎么样？', 'tools': None}
2025-06-08 09:58:10,533 - gongdi-api - DEBUG - 使用默认工具: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 09:58:10,535 - gongdi-api - DEBUG - 使用测试模式处理请求
2025-06-08 09:58:10,535 - gongdi-api - DEBUG - API响应: {'status_code': <HTTPStatus.OK: 200>, 'request_id': 'mock-func-12345', 'choices': [{'message': {'role': 'assistant', 'content': '', 'tool_calls': [{'id': 'mock-call-12345', 'type': 'function', 'function': {'name': 'get_current_weather', 'arguments': '{"location": "\\u676d\\u5dde"}'}}]}}]}
2025-06-08 09:58:10,536 - gongdi-api - DEBUG - 工具调用信息: {'id': 'mock-call-12345', 'function_name': 'get_current_weather', 'arguments': {'location': '杭州'}}
2025-06-08 09:58:10,537 - gongdi-api - DEBUG - 最终返回结果: {'status_code': <HTTPStatus.OK: 200>, 'request_id': 'mock-func-12345', 'message': {'role': 'assistant', 'content': '', 'tool_calls': [{'id': 'mock-call-12345', 'type': 'function', 'function': {'name': 'get_current_weather', 'arguments': '{"location": "\\u676d\\u5dde"}'}}]}, 'tool_calls': [{'id': 'mock-call-12345', 'function_name': 'get_current_weather', 'arguments': {'location': '杭州'}}]}
2025-06-08 09:58:39,355 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:58:39,625 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:58:39,956 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:58:40,059 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:59:00,923 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:59:02,345 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:59:02,373 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:59:02,679 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:59:07,158 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:59:08,442 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:59:08,552 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:59:08,906 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:59:26,201 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:59:26,316 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:59:26,339 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:59:27,358 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:59:39,024 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:59:41,240 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:59:42,260 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:59:42,509 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:59:42,671 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 09:59:43,787 - gongdi-api - DEBUG - 接收到函数调用请求: {'query': '现在几点了？', 'tools': None}
2025-06-08 09:59:43,806 - gongdi-api - DEBUG - 使用默认工具: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 09:59:43,832 - gongdi-api - DEBUG - 调用DashscopeClient处理请求，query: 现在几点了？
2025-06-08 09:59:43,843 - gongdi-api.dashscope - DEBUG - DashscopeClient初始化: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 09:59:43,868 - gongdi-api.dashscope - DEBUG - 接收function_call请求: messages=[{'role': 'user', 'content': '现在几点了？'}]
2025-06-08 09:59:43,873 - gongdi-api.dashscope - DEBUG - 原始工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 09:59:43,882 - gongdi-api.dashscope - DEBUG - 格式化后的工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 09:59:43,906 - gongdi-api.dashscope - DEBUG - 调用DashScope API参数: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 09:59:43,922 - gongdi-api.dashscope - DEBUG - 开始调用DashScope API...
2025-06-08 09:59:44,255 - dashscope - DEBUG - Request body: {'model': 'qwen-turbo', 'parameters': {'tools': [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}], 'temperature': 0, 'max_tokens': 2048, 'result_format': 'message'}, 'input': {'messages': [{'role': 'user', 'content': '现在几点了？'}]}}
2025-06-08 09:59:44,265 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): dashscope.aliyuncs.com:443
2025-06-08 09:59:46,538 - urllib3.connectionpool - DEBUG - https://dashscope.aliyuncs.com:443 "POST /api/v1/services/aigc/text-generation/generation HTTP/1.1" 200 None
2025-06-08 09:59:46,540 - dashscope - DEBUG - Response: {'output': {'choices': [{'finish_reason': 'tool_calls', 'message': {'role': 'assistant', 'tool_calls': [{'function': {'name': 'get_current_time', 'arguments': '{}'}, 'index': 0, 'id': 'call_096d70be309d4f8b869214', 'type': 'function'}], 'content': ''}}]}, 'usage': {'total_tokens': 238, 'output_tokens': 13, 'input_tokens': 225, 'prompt_tokens_details': {'cached_tokens': 0}}, 'request_id': '689a2cc4-06a5-9ff5-974e-1b5191b7d885'}
2025-06-08 09:59:46,546 - gongdi-api.dashscope - DEBUG - DashScope API响应状态码: 200
2025-06-08 09:59:46,547 - gongdi-api.dashscope - DEBUG - 成功处理响应: request_id=689a2cc4-06a5-9ff5-974e-1b5191b7d885
2025-06-08 09:59:46,547 - gongdi-api - DEBUG - API响应: {'status_code': <HTTPStatus.OK: 200>, 'request_id': '689a2cc4-06a5-9ff5-974e-1b5191b7d885', 'choices': [{'message': Message({'role': 'assistant', 'content': '', 'tool_calls': [{'function': {'name': 'get_current_time', 'arguments': '{}'}, 'index': 0, 'id': 'call_096d70be309d4f8b869214', 'type': 'function'}]})}], 'usage': {}}
2025-06-08 09:59:46,548 - gongdi-api - DEBUG - 工具调用信息: {'id': 'call_096d70be309d4f8b869214', 'function_name': 'get_current_time', 'arguments': {}}
2025-06-08 09:59:46,549 - gongdi-api - DEBUG - 最终返回结果: {'status_code': <HTTPStatus.OK: 200>, 'request_id': '689a2cc4-06a5-9ff5-974e-1b5191b7d885', 'message': Message({'role': 'assistant', 'content': '', 'tool_calls': [{'function': {'name': 'get_current_time', 'arguments': '{}'}, 'index': 0, 'id': 'call_096d70be309d4f8b869214', 'type': 'function'}]}), 'tool_calls': [{'id': 'call_096d70be309d4f8b869214', 'function_name': 'get_current_time', 'arguments': {}}]}
2025-06-08 09:59:46,581 - gongdi-api - DEBUG - 接收到函数调用请求: {'query': '杭州的天气怎么样？', 'tools': None}
2025-06-08 09:59:46,582 - gongdi-api - DEBUG - 使用默认工具: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 09:59:46,583 - gongdi-api - DEBUG - 调用DashscopeClient处理请求，query: 杭州的天气怎么样？
2025-06-08 09:59:46,584 - gongdi-api.dashscope - DEBUG - DashscopeClient初始化: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 09:59:46,584 - gongdi-api.dashscope - DEBUG - 接收function_call请求: messages=[{'role': 'user', 'content': '杭州的天气怎么样？'}]
2025-06-08 09:59:46,586 - gongdi-api.dashscope - DEBUG - 原始工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 09:59:46,587 - gongdi-api.dashscope - DEBUG - 格式化后的工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 09:59:46,589 - gongdi-api.dashscope - DEBUG - 调用DashScope API参数: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 09:59:46,589 - gongdi-api.dashscope - DEBUG - 开始调用DashScope API...
2025-06-08 09:59:46,590 - dashscope - DEBUG - Request body: {'model': 'qwen-turbo', 'parameters': {'tools': [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}], 'temperature': 0, 'max_tokens': 2048, 'result_format': 'message'}, 'input': {'messages': [{'role': 'user', 'content': '杭州的天气怎么样？'}]}}
2025-06-08 09:59:46,596 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): dashscope.aliyuncs.com:443
2025-06-08 09:59:48,757 - urllib3.connectionpool - DEBUG - https://dashscope.aliyuncs.com:443 "POST /api/v1/services/aigc/text-generation/generation HTTP/1.1" 200 None
2025-06-08 09:59:48,759 - dashscope - DEBUG - Response: {'output': {'choices': [{'finish_reason': 'tool_calls', 'message': {'role': 'assistant', 'tool_calls': [{'function': {'name': 'get_current_weather', 'arguments': '{"location": "杭州市"}'}, 'index': 0, 'id': 'call_4b72cb93b24d4298b966fd', 'type': 'function'}], 'content': ''}}]}, 'usage': {'total_tokens': 244, 'output_tokens': 18, 'input_tokens': 226, 'prompt_tokens_details': {'cached_tokens': 0}}, 'request_id': 'aec54359-71e5-9527-bd89-f2bfd36b022c'}
2025-06-08 09:59:48,766 - gongdi-api.dashscope - DEBUG - DashScope API响应状态码: 200
2025-06-08 09:59:48,766 - gongdi-api.dashscope - DEBUG - 成功处理响应: request_id=aec54359-71e5-9527-bd89-f2bfd36b022c
2025-06-08 09:59:48,767 - gongdi-api - DEBUG - API响应: {'status_code': <HTTPStatus.OK: 200>, 'request_id': 'aec54359-71e5-9527-bd89-f2bfd36b022c', 'choices': [{'message': Message({'role': 'assistant', 'content': '', 'tool_calls': [{'function': {'name': 'get_current_weather', 'arguments': '{"location": "杭州市"}'}, 'index': 0, 'id': 'call_4b72cb93b24d4298b966fd', 'type': 'function'}]})}], 'usage': {}}
2025-06-08 09:59:48,768 - gongdi-api - DEBUG - 工具调用信息: {'id': 'call_4b72cb93b24d4298b966fd', 'function_name': 'get_current_weather', 'arguments': {'location': '杭州市'}}
2025-06-08 09:59:48,769 - gongdi-api - DEBUG - 最终返回结果: {'status_code': <HTTPStatus.OK: 200>, 'request_id': 'aec54359-71e5-9527-bd89-f2bfd36b022c', 'message': Message({'role': 'assistant', 'content': '', 'tool_calls': [{'function': {'name': 'get_current_weather', 'arguments': '{"location": "杭州市"}'}, 'index': 0, 'id': 'call_4b72cb93b24d4298b966fd', 'type': 'function'}]}), 'tool_calls': [{'id': 'call_4b72cb93b24d4298b966fd', 'function_name': 'get_current_weather', 'arguments': {'location': '杭州市'}}]}
2025-06-08 09:59:48,792 - gongdi-api.dashscope - DEBUG - DashscopeClient初始化: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 09:59:48,793 - gongdi-api.dashscope - DEBUG - 接收function_call请求: messages=[{'role': 'user', 'content': '北京现在几点了？天气怎么样？'}]
2025-06-08 09:59:48,794 - gongdi-api.dashscope - DEBUG - 原始工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 09:59:48,796 - gongdi-api.dashscope - DEBUG - 格式化后的工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 09:59:48,797 - gongdi-api.dashscope - DEBUG - 调用DashScope API参数: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 09:59:48,798 - gongdi-api.dashscope - DEBUG - 开始调用DashScope API...
2025-06-08 09:59:48,799 - dashscope - DEBUG - Request body: {'model': 'qwen-turbo', 'parameters': {'tools': [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}], 'temperature': 0, 'max_tokens': 2048, 'result_format': 'message'}, 'input': {'messages': [{'role': 'user', 'content': '北京现在几点了？天气怎么样？'}]}}
2025-06-08 09:59:48,803 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): dashscope.aliyuncs.com:443
2025-06-08 09:59:50,901 - urllib3.connectionpool - DEBUG - https://dashscope.aliyuncs.com:443 "POST /api/v1/services/aigc/text-generation/generation HTTP/1.1" 200 None
2025-06-08 09:59:50,902 - dashscope - DEBUG - Response: {'output': {'choices': [{'finish_reason': 'tool_calls', 'message': {'role': 'assistant', 'tool_calls': [{'function': {'name': 'get_current_time', 'arguments': '{}'}, 'index': 0, 'id': 'call_b712a1eec23744e3ae499b', 'type': 'function'}], 'content': ''}}]}, 'usage': {'total_tokens': 242, 'output_tokens': 13, 'input_tokens': 229, 'prompt_tokens_details': {'cached_tokens': 0}}, 'request_id': 'e67e6380-e59c-9d48-bb9d-6c877eef546b'}
2025-06-08 09:59:50,906 - gongdi-api.dashscope - DEBUG - DashScope API响应状态码: 200
2025-06-08 09:59:50,907 - gongdi-api.dashscope - DEBUG - 成功处理响应: request_id=e67e6380-e59c-9d48-bb9d-6c877eef546b
2025-06-08 09:59:50,908 - gongdi-api.dashscope - DEBUG - DashscopeClient初始化: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 09:59:50,909 - dashscope - DEBUG - Request body: {'model': 'qwen-turbo', 'parameters': {'temperature': 0, 'max_tokens': 2048, 'result_format': 'message'}, 'input': {'messages': [{'role': 'user', 'content': '北京现在几点了？天气怎么样？'}, {'role': 'assistant', 'content': '', 'tool_calls': [{'function': {'name': 'get_current_time', 'arguments': '{}'}, 'index': 0, 'id': 'call_b712a1eec23744e3ae499b', 'type': 'function'}]}, {'tool_call_id': 'call_b712a1eec23744e3ae499b', 'role': 'tool', 'content': '{"datetime": "2025-06-08 09:59:50", "date": "2025-06-08", "time": "09:59:50", "weekday": "Sunday"}'}]}}
2025-06-08 09:59:50,913 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): dashscope.aliyuncs.com:443
2025-06-08 09:59:53,374 - urllib3.connectionpool - DEBUG - https://dashscope.aliyuncs.com:443 "POST /api/v1/services/aigc/text-generation/generation HTTP/1.1" 200 None
2025-06-08 09:59:53,376 - dashscope - DEBUG - Response: {'output': {'choices': [{'finish_reason': 'stop', 'message': {'role': 'assistant', 'content': '根据提供的信息，北京当前时间是 **2025年6月8日 星期日 上午09:59**。\n\n关于天气情况，由于你没有提供具体的天气数据，我无法直接告知天气状况。不过，如果你需要查询实时天气，可以通过天气预报网站或相关应用程序获取最新的北京天气信息。'}}]}, 'usage': {'total_tokens': 156, 'output_tokens': 71, 'input_tokens': 85, 'prompt_tokens_details': {'cached_tokens': 0}}, 'request_id': 'ed0a33e7-d7e7-95b2-8305-2de9f56991b2'}
2025-06-08 10:00:21,015 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 10:00:21,106 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 10:00:21,238 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 10:00:21,929 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 10:00:22,816 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 10:00:24,185 - gongdi-api - DEBUG - 接收到函数调用请求: {'query': '现在几点了？', 'tools': None}
2025-06-08 10:00:24,187 - gongdi-api - DEBUG - 使用默认工具: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 10:00:24,188 - gongdi-api - DEBUG - 使用测试模式处理请求
2025-06-08 10:00:24,189 - gongdi-api - DEBUG - API响应: {'status_code': <HTTPStatus.OK: 200>, 'request_id': 'mock-func-12345', 'choices': [{'message': {'role': 'assistant', 'content': '', 'tool_calls': [{'id': 'mock-call-12345', 'type': 'function', 'function': {'name': 'get_current_time', 'arguments': '{}'}}]}}]}
2025-06-08 10:00:24,190 - gongdi-api - DEBUG - 工具调用信息: {'id': 'mock-call-12345', 'function_name': 'get_current_time', 'arguments': {}}
2025-06-08 10:00:24,191 - gongdi-api - DEBUG - 最终返回结果: {'status_code': <HTTPStatus.OK: 200>, 'request_id': 'mock-func-12345', 'message': {'role': 'assistant', 'content': '', 'tool_calls': [{'id': 'mock-call-12345', 'type': 'function', 'function': {'name': 'get_current_time', 'arguments': '{}'}}]}, 'tool_calls': [{'id': 'mock-call-12345', 'function_name': 'get_current_time', 'arguments': {}}]}
2025-06-08 10:00:26,786 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 10:00:52,852 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 10:00:52,852 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 10:00:53,038 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 10:00:53,231 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 10:00:53,336 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 10:00:55,777 - gongdi-api - DEBUG - 接收到函数调用请求: {'query': '现在几点了？', 'tools': None}
2025-06-08 10:00:55,778 - gongdi-api - DEBUG - 使用默认工具: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 10:00:55,780 - gongdi-api - DEBUG - 使用测试模式处理请求
2025-06-08 10:00:55,780 - gongdi-api - DEBUG - API响应: {'status_code': <HTTPStatus.OK: 200>, 'request_id': 'mock-func-12345', 'choices': [{'message': {'role': 'assistant', 'content': '', 'tool_calls': [{'id': 'mock-call-12345', 'type': 'function', 'function': {'name': 'get_current_time', 'arguments': '{}'}}]}}]}
2025-06-08 10:00:55,781 - gongdi-api - DEBUG - 工具调用信息: {'id': 'mock-call-12345', 'function_name': 'get_current_time', 'arguments': {}}
2025-06-08 10:00:55,782 - gongdi-api - DEBUG - 最终返回结果: {'status_code': <HTTPStatus.OK: 200>, 'request_id': 'mock-func-12345', 'message': {'role': 'assistant', 'content': '', 'tool_calls': [{'id': 'mock-call-12345', 'type': 'function', 'function': {'name': 'get_current_time', 'arguments': '{}'}}]}, 'tool_calls': [{'id': 'mock-call-12345', 'function_name': 'get_current_time', 'arguments': {}}]}
2025-06-08 10:00:55,794 - gongdi-api - DEBUG - 接收到函数调用请求: {'query': '杭州的天气怎么样？', 'tools': None}
2025-06-08 10:00:55,795 - gongdi-api - DEBUG - 使用默认工具: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 10:00:55,797 - gongdi-api - DEBUG - 使用测试模式处理请求
2025-06-08 10:00:55,797 - gongdi-api - DEBUG - API响应: {'status_code': <HTTPStatus.OK: 200>, 'request_id': 'mock-func-12345', 'choices': [{'message': {'role': 'assistant', 'content': '', 'tool_calls': [{'id': 'mock-call-12345', 'type': 'function', 'function': {'name': 'get_current_weather', 'arguments': '{"location": "\\u676d\\u5dde"}'}}]}}]}
2025-06-08 10:00:55,798 - gongdi-api - DEBUG - 工具调用信息: {'id': 'mock-call-12345', 'function_name': 'get_current_weather', 'arguments': {'location': '杭州'}}
2025-06-08 10:00:55,799 - gongdi-api - DEBUG - 最终返回结果: {'status_code': <HTTPStatus.OK: 200>, 'request_id': 'mock-func-12345', 'message': {'role': 'assistant', 'content': '', 'tool_calls': [{'id': 'mock-call-12345', 'type': 'function', 'function': {'name': 'get_current_weather', 'arguments': '{"location": "\\u676d\\u5dde"}'}}]}, 'tool_calls': [{'id': 'mock-call-12345', 'function_name': 'get_current_weather', 'arguments': {'location': '杭州'}}]}
2025-06-08 10:01:02,803 - gongdi-api - DEBUG - 接收到函数调用请求: {'query': '现在几点了？', 'tools': None}
2025-06-08 10:01:02,804 - gongdi-api - DEBUG - 使用默认工具: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 10:01:02,806 - gongdi-api - DEBUG - 使用测试模式处理请求
2025-06-08 10:01:02,807 - gongdi-api - DEBUG - API响应: {'status_code': <HTTPStatus.OK: 200>, 'request_id': 'mock-func-12345', 'choices': [{'message': {'role': 'assistant', 'content': '', 'tool_calls': [{'id': 'mock-call-12345', 'type': 'function', 'function': {'name': 'get_current_time', 'arguments': '{}'}}]}}]}
2025-06-08 10:01:02,808 - gongdi-api - DEBUG - 工具调用信息: {'id': 'mock-call-12345', 'function_name': 'get_current_time', 'arguments': {}}
2025-06-08 10:01:02,809 - gongdi-api - DEBUG - 最终返回结果: {'status_code': <HTTPStatus.OK: 200>, 'request_id': 'mock-func-12345', 'message': {'role': 'assistant', 'content': '', 'tool_calls': [{'id': 'mock-call-12345', 'type': 'function', 'function': {'name': 'get_current_time', 'arguments': '{}'}}]}, 'tool_calls': [{'id': 'mock-call-12345', 'function_name': 'get_current_time', 'arguments': {}}]}
2025-06-08 10:01:25,527 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 10:01:26,590 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 10:01:26,609 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 10:01:26,746 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 10:01:26,778 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 10:01:29,318 - gongdi-api - DEBUG - 接收到函数调用请求: {'query': '现在几点了？', 'tools': None}
2025-06-08 10:01:29,318 - gongdi-api - DEBUG - 使用默认工具: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 10:01:29,320 - gongdi-api - DEBUG - 使用测试模式处理请求
2025-06-08 10:01:29,321 - gongdi-api - DEBUG - API响应: {'status_code': <HTTPStatus.OK: 200>, 'request_id': 'mock-func-12345', 'choices': [{'message': {'role': 'assistant', 'content': '', 'tool_calls': [{'id': 'mock-call-12345', 'type': 'function', 'function': {'name': 'get_current_time', 'arguments': '{}'}}]}}]}
2025-06-08 10:01:29,322 - gongdi-api - DEBUG - 工具调用信息: {'id': 'mock-call-12345', 'function_name': 'get_current_time', 'arguments': {}}
2025-06-08 10:01:29,323 - gongdi-api - DEBUG - 最终返回结果: {'status_code': <HTTPStatus.OK: 200>, 'request_id': 'mock-func-12345', 'message': {'role': 'assistant', 'content': '', 'tool_calls': [{'id': 'mock-call-12345', 'type': 'function', 'function': {'name': 'get_current_time', 'arguments': '{}'}}]}, 'tool_calls': [{'id': 'mock-call-12345', 'function_name': 'get_current_time', 'arguments': {}}]}
2025-06-08 10:01:29,337 - gongdi-api - DEBUG - 接收到函数调用请求: {'query': '杭州的天气怎么样？', 'tools': None}
2025-06-08 10:01:29,338 - gongdi-api - DEBUG - 使用默认工具: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 10:01:29,339 - gongdi-api - DEBUG - 使用测试模式处理请求
2025-06-08 10:01:29,340 - gongdi-api - DEBUG - API响应: {'status_code': <HTTPStatus.OK: 200>, 'request_id': 'mock-func-12345', 'choices': [{'message': {'role': 'assistant', 'content': '', 'tool_calls': [{'id': 'mock-call-12345', 'type': 'function', 'function': {'name': 'get_current_weather', 'arguments': '{"location": "\\u676d\\u5dde"}'}}]}}]}
2025-06-08 10:01:29,341 - gongdi-api - DEBUG - 工具调用信息: {'id': 'mock-call-12345', 'function_name': 'get_current_weather', 'arguments': {'location': '杭州'}}
2025-06-08 10:01:29,342 - gongdi-api - DEBUG - 最终返回结果: {'status_code': <HTTPStatus.OK: 200>, 'request_id': 'mock-func-12345', 'message': {'role': 'assistant', 'content': '', 'tool_calls': [{'id': 'mock-call-12345', 'type': 'function', 'function': {'name': 'get_current_weather', 'arguments': '{"location": "\\u676d\\u5dde"}'}}]}, 'tool_calls': [{'id': 'mock-call-12345', 'function_name': 'get_current_weather', 'arguments': {'location': '杭州'}}]}
2025-06-08 10:03:54,875 - gongdi-api - DEBUG - 接收到函数调用请求: {'query': '时间', 'tools': [{}]}
2025-06-08 10:03:54,876 - gongdi-api - DEBUG - 使用默认工具: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 10:03:54,877 - gongdi-api - DEBUG - 使用测试模式处理请求
2025-06-08 10:03:54,878 - gongdi-api - DEBUG - API响应: {'status_code': <HTTPStatus.OK: 200>, 'request_id': 'mock-func-12345', 'choices': [{'message': {'role': 'assistant', 'content': '', 'tool_calls': [{'id': 'mock-call-12345', 'type': 'function', 'function': {'name': 'get_current_time', 'arguments': '{}'}}]}}]}
2025-06-08 10:03:54,879 - gongdi-api - DEBUG - 工具调用信息: {'id': 'mock-call-12345', 'function_name': 'get_current_time', 'arguments': {}}
2025-06-08 10:03:54,880 - gongdi-api - DEBUG - 最终返回结果: {'status_code': <HTTPStatus.OK: 200>, 'request_id': 'mock-func-12345', 'message': {'role': 'assistant', 'content': '', 'tool_calls': [{'id': 'mock-call-12345', 'type': 'function', 'function': {'name': 'get_current_time', 'arguments': '{}'}}]}, 'tool_calls': [{'id': 'mock-call-12345', 'function_name': 'get_current_time', 'arguments': {}}]}
2025-06-08 10:05:25,231 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 10:05:49,049 - gongdi-api - DEBUG - 接收到函数调用请求: {'query': '天气', 'tools': [{}]}
2025-06-08 10:05:49,050 - gongdi-api - DEBUG - 使用默认工具: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 10:05:49,051 - gongdi-api - DEBUG - 使用测试模式处理请求
2025-06-08 10:05:49,052 - gongdi-api - DEBUG - API响应: {'status_code': <HTTPStatus.OK: 200>, 'request_id': 'mock-func-12345', 'choices': [{'message': {'role': 'assistant', 'content': '', 'tool_calls': [{'id': 'mock-call-12345', 'type': 'function', 'function': {'name': 'get_current_weather', 'arguments': '{"location": "\\u5317\\u4eac"}'}}]}}]}
2025-06-08 10:05:49,053 - gongdi-api - DEBUG - 工具调用信息: {'id': 'mock-call-12345', 'function_name': 'get_current_weather', 'arguments': {'location': '北京'}}
2025-06-08 10:05:49,053 - gongdi-api - DEBUG - 最终返回结果: {'status_code': <HTTPStatus.OK: 200>, 'request_id': 'mock-func-12345', 'message': {'role': 'assistant', 'content': '', 'tool_calls': [{'id': 'mock-call-12345', 'type': 'function', 'function': {'name': 'get_current_weather', 'arguments': '{"location": "\\u5317\\u4eac"}'}}]}, 'tool_calls': [{'id': 'mock-call-12345', 'function_name': 'get_current_weather', 'arguments': {'location': '北京'}}]}
2025-06-08 10:53:39,038 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 10:53:40,719 - gongdi-api - ERROR - 无法导入必要的模块，请检查依赖项
2025-06-08 10:53:45,024 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 10:53:46,978 - gongdi-api - ERROR - 无法导入必要的模块，请检查依赖项
2025-06-08 10:53:47,794 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 10:53:48,119 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 10:53:48,225 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 10:53:50,640 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 10:56:47,939 - gongdi-api - DEBUG - 接收到函数调用请求: {'query': '天气', 'tools': [{}]}
2025-06-08 10:56:47,940 - gongdi-api - DEBUG - 使用默认工具: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 10:56:47,941 - gongdi-api - DEBUG - 调用DashscopeClient处理请求，query: 天气
2025-06-08 10:56:47,942 - gongdi-api.dashscope - DEBUG - DashscopeClient初始化: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 10:56:47,943 - gongdi-api.dashscope - DEBUG - 接收function_call请求: messages=[{'role': 'user', 'content': '天气'}]
2025-06-08 10:56:47,943 - gongdi-api.dashscope - DEBUG - 原始工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 10:56:47,945 - gongdi-api.dashscope - DEBUG - 格式化后的工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 10:56:47,946 - gongdi-api.dashscope - DEBUG - 调用DashScope API参数: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 10:56:47,947 - gongdi-api.dashscope - DEBUG - 开始调用DashScope API...
2025-06-08 10:56:48,031 - dashscope - DEBUG - Request body: {'model': 'qwen-turbo', 'parameters': {'tools': [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}], 'temperature': 0, 'max_tokens': 2048, 'result_format': 'message'}, 'input': {'messages': [{'role': 'user', 'content': '天气'}]}}
2025-06-08 10:56:48,039 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): dashscope.aliyuncs.com:443
2025-06-08 10:56:49,765 - urllib3.connectionpool - DEBUG - https://dashscope.aliyuncs.com:443 "POST /api/v1/services/aigc/text-generation/generation HTTP/1.1" 200 None
2025-06-08 10:56:49,767 - dashscope - DEBUG - Response: {'output': {'choices': [{'finish_reason': 'stop', 'message': {'role': 'assistant', 'content': '请告诉我您想查询哪个城市的天气？'}}]}, 'usage': {'total_tokens': 231, 'output_tokens': 9, 'input_tokens': 222, 'prompt_tokens_details': {'cached_tokens': 0}}, 'request_id': 'fbd76907-19e7-9a3d-af4d-5faadc74f37b'}
2025-06-08 10:56:49,773 - gongdi-api.dashscope - DEBUG - DashScope API响应状态码: 200
2025-06-08 10:56:49,773 - gongdi-api.dashscope - DEBUG - 成功处理响应: request_id=fbd76907-19e7-9a3d-af4d-5faadc74f37b
2025-06-08 10:56:49,774 - gongdi-api - DEBUG - API响应: {'status_code': <HTTPStatus.OK: 200>, 'request_id': 'fbd76907-19e7-9a3d-af4d-5faadc74f37b', 'choices': [{'message': Message({'role': 'assistant', 'content': '请告诉我您想查询哪个城市的天气？'})}], 'usage': {}}
2025-06-08 10:56:49,775 - gongdi-api - DEBUG - 响应中没有工具调用
2025-06-08 10:58:37,731 - gongdi-api - DEBUG - 接收到函数调用请求: {'query': '时间', 'tools': [{}]}
2025-06-08 10:58:37,732 - gongdi-api - DEBUG - 使用默认工具: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 10:58:37,733 - gongdi-api - DEBUG - 调用DashscopeClient处理请求，query: 时间
2025-06-08 10:58:37,734 - gongdi-api.dashscope - DEBUG - DashscopeClient初始化: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 10:58:37,734 - gongdi-api.dashscope - DEBUG - 接收function_call请求: messages=[{'role': 'user', 'content': '时间'}]
2025-06-08 10:58:37,735 - gongdi-api.dashscope - DEBUG - 原始工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 10:58:37,736 - gongdi-api.dashscope - DEBUG - 格式化后的工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 10:58:37,737 - gongdi-api.dashscope - DEBUG - 调用DashScope API参数: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 10:58:37,737 - gongdi-api.dashscope - DEBUG - 开始调用DashScope API...
2025-06-08 10:58:37,738 - dashscope - DEBUG - Request body: {'model': 'qwen-turbo', 'parameters': {'tools': [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}], 'temperature': 0, 'max_tokens': 2048, 'result_format': 'message'}, 'input': {'messages': [{'role': 'user', 'content': '时间'}]}}
2025-06-08 10:58:37,742 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): dashscope.aliyuncs.com:443
2025-06-08 10:58:40,232 - urllib3.connectionpool - DEBUG - https://dashscope.aliyuncs.com:443 "POST /api/v1/services/aigc/text-generation/generation HTTP/1.1" 200 None
2025-06-08 10:58:40,234 - dashscope - DEBUG - Response: {'output': {'choices': [{'finish_reason': 'tool_calls', 'message': {'role': 'assistant', 'tool_calls': [{'function': {'name': 'get_current_time', 'arguments': '{}'}, 'index': 0, 'id': 'call_6f4dc0e3136d4972a2724c', 'type': 'function'}], 'content': ''}}]}, 'usage': {'total_tokens': 235, 'output_tokens': 13, 'input_tokens': 222, 'prompt_tokens_details': {'cached_tokens': 0}}, 'request_id': 'dbd1c25b-b260-9903-9a5d-e12906d9ddc7'}
2025-06-08 10:58:40,240 - gongdi-api.dashscope - DEBUG - DashScope API响应状态码: 200
2025-06-08 10:58:40,240 - gongdi-api.dashscope - DEBUG - 成功处理响应: request_id=dbd1c25b-b260-9903-9a5d-e12906d9ddc7
2025-06-08 10:58:40,241 - gongdi-api - DEBUG - API响应: {'status_code': <HTTPStatus.OK: 200>, 'request_id': 'dbd1c25b-b260-9903-9a5d-e12906d9ddc7', 'choices': [{'message': Message({'role': 'assistant', 'content': '', 'tool_calls': [{'function': {'name': 'get_current_time', 'arguments': '{}'}, 'index': 0, 'id': 'call_6f4dc0e3136d4972a2724c', 'type': 'function'}]})}], 'usage': {}}
2025-06-08 10:58:40,242 - gongdi-api - DEBUG - 工具调用信息: {'id': 'call_6f4dc0e3136d4972a2724c', 'function_name': 'get_current_time', 'arguments': {}}
2025-06-08 10:58:40,243 - gongdi-api - DEBUG - 最终返回结果: {'status_code': <HTTPStatus.OK: 200>, 'request_id': 'dbd1c25b-b260-9903-9a5d-e12906d9ddc7', 'message': Message({'role': 'assistant', 'content': '', 'tool_calls': [{'function': {'name': 'get_current_time', 'arguments': '{}'}, 'index': 0, 'id': 'call_6f4dc0e3136d4972a2724c', 'type': 'function'}]}), 'tool_calls': [{'id': 'call_6f4dc0e3136d4972a2724c', 'function_name': 'get_current_time', 'arguments': {}}]}
2025-06-08 11:01:42,524 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:01:42,657 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:05:49,746 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:05:49,767 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:05:49,788 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:05:50,005 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:05:50,684 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:05:51,182 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:06:46,259 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:06:46,906 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:06:47,590 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:06:47,673 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:06:47,812 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:07:20,450 - gongdi-api - DEBUG - 接收到函数调用请求: {'query': '时间', 'tools': [{}]}
2025-06-08 11:07:20,451 - gongdi-api - DEBUG - 使用默认工具: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 11:07:20,452 - gongdi-api - DEBUG - 调用DashscopeClient处理请求，query: 时间
2025-06-08 11:07:20,453 - gongdi-api.dashscope - DEBUG - DashscopeClient初始化: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 11:07:20,454 - gongdi-api.dashscope - DEBUG - 接收function_call请求: messages=[{'role': 'user', 'content': '时间'}]
2025-06-08 11:07:20,454 - gongdi-api.dashscope - DEBUG - 原始工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 11:07:20,455 - gongdi-api.dashscope - DEBUG - 格式化后的工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 11:07:20,457 - gongdi-api.dashscope - DEBUG - 调用DashScope API参数: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 11:07:20,457 - gongdi-api.dashscope - DEBUG - 开始调用DashScope API...
2025-06-08 11:07:20,561 - dashscope - DEBUG - Request body: {'model': 'qwen-turbo', 'parameters': {'tools': [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}], 'temperature': 0, 'max_tokens': 2048, 'result_format': 'message'}, 'input': {'messages': [{'role': 'user', 'content': '时间'}]}}
2025-06-08 11:07:20,569 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): dashscope.aliyuncs.com:443
2025-06-08 11:07:22,752 - urllib3.connectionpool - DEBUG - https://dashscope.aliyuncs.com:443 "POST /api/v1/services/aigc/text-generation/generation HTTP/1.1" 200 None
2025-06-08 11:07:22,754 - dashscope - DEBUG - Response: {'output': {'choices': [{'finish_reason': 'tool_calls', 'message': {'role': 'assistant', 'tool_calls': [{'function': {'name': 'get_current_time', 'arguments': '{}'}, 'index': 0, 'id': 'call_cd2ab2efbd4647639bffb2', 'type': 'function'}], 'content': ''}}]}, 'usage': {'total_tokens': 235, 'output_tokens': 13, 'input_tokens': 222, 'prompt_tokens_details': {'cached_tokens': 0}}, 'request_id': '2ca616e1-187e-9dc1-959b-ef6a6ee83801'}
2025-06-08 11:07:22,761 - gongdi-api.dashscope - DEBUG - DashScope API响应状态码: 200
2025-06-08 11:07:22,762 - gongdi-api.dashscope - DEBUG - 成功处理响应: request_id=2ca616e1-187e-9dc1-959b-ef6a6ee83801
2025-06-08 11:07:22,762 - gongdi-api - DEBUG - API响应: {'status_code': <HTTPStatus.OK: 200>, 'request_id': '2ca616e1-187e-9dc1-959b-ef6a6ee83801', 'choices': [{'message': Message({'role': 'assistant', 'content': '', 'tool_calls': [{'function': {'name': 'get_current_time', 'arguments': '{}'}, 'index': 0, 'id': 'call_cd2ab2efbd4647639bffb2', 'type': 'function'}]})}], 'usage': {}}
2025-06-08 11:07:22,763 - gongdi-api - DEBUG - 工具调用信息: {'id': 'call_cd2ab2efbd4647639bffb2', 'function_name': 'get_current_time', 'arguments': {}}
2025-06-08 11:07:22,764 - gongdi-api - DEBUG - 执行函数: get_current_time, 参数: {}
2025-06-08 11:07:22,765 - gongdi-api - DEBUG - 函数执行结果: {'datetime': '2025-06-08 11:07:22', 'date': '2025-06-08', 'time': '11:07:22', 'weekday': 'Sunday'}
2025-06-08 11:07:22,766 - gongdi-api - DEBUG - 最终返回结果: {'datetime': '2025-06-08 11:07:22', 'date': '2025-06-08', 'time': '11:07:22', 'weekday': 'Sunday', 'tool_calls': [{'id': 'call_cd2ab2efbd4647639bffb2', 'function_name': 'get_current_time', 'arguments': {}}], 'executed_results': [{'id': 'call_cd2ab2efbd4647639bffb2', 'function_name': 'get_current_time', 'success': True, 'result': {...}}]}
2025-06-08 11:10:47,470 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:10:58,755 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:11:00,123 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:11:00,133 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:11:00,273 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:11:01,197 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:11:01,653 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:12:17,866 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:12:18,144 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:12:18,415 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:12:18,865 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:12:19,874 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:12:19,916 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:12:22,256 - gongdi-api - DEBUG - 接收到函数调用请求: {'query': '时间', 'tools': [{}]}
2025-06-08 11:12:22,257 - gongdi-api - DEBUG - 使用默认工具: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 11:12:22,258 - gongdi-api - DEBUG - 调用DashscopeClient处理请求，query: 时间
2025-06-08 11:12:22,258 - gongdi-api.dashscope - DEBUG - DashscopeClient初始化: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 11:12:22,259 - gongdi-api.dashscope - DEBUG - 接收function_call请求: messages=[{'role': 'user', 'content': '时间'}]
2025-06-08 11:12:22,259 - gongdi-api.dashscope - DEBUG - 原始工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 11:12:22,261 - gongdi-api.dashscope - DEBUG - 格式化后的工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 11:12:22,262 - gongdi-api.dashscope - DEBUG - 调用DashScope API参数: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 11:12:22,263 - gongdi-api.dashscope - DEBUG - 开始调用DashScope API...
2025-06-08 11:12:22,343 - dashscope - DEBUG - Request body: {'model': 'qwen-turbo', 'parameters': {'tools': [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}], 'temperature': 0, 'max_tokens': 2048, 'result_format': 'message'}, 'input': {'messages': [{'role': 'user', 'content': '时间'}]}}
2025-06-08 11:12:22,351 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): dashscope.aliyuncs.com:443
2025-06-08 11:12:24,567 - urllib3.connectionpool - DEBUG - https://dashscope.aliyuncs.com:443 "POST /api/v1/services/aigc/text-generation/generation HTTP/1.1" 200 None
2025-06-08 11:12:24,570 - dashscope - DEBUG - Response: {'output': {'choices': [{'finish_reason': 'tool_calls', 'message': {'role': 'assistant', 'tool_calls': [{'function': {'name': 'get_current_time', 'arguments': '{}'}, 'index': 0, 'id': 'call_4931f5d2597e4acd9f0b00', 'type': 'function'}], 'content': ''}}]}, 'usage': {'total_tokens': 235, 'output_tokens': 13, 'input_tokens': 222, 'prompt_tokens_details': {'cached_tokens': 0}}, 'request_id': '95fc53e9-f0c8-9477-9b35-b1c3dee233f1'}
2025-06-08 11:12:24,573 - gongdi-api.dashscope - DEBUG - DashScope API响应状态码: 200
2025-06-08 11:12:24,574 - gongdi-api.dashscope - DEBUG - 成功处理响应: request_id=95fc53e9-f0c8-9477-9b35-b1c3dee233f1
2025-06-08 11:12:24,575 - gongdi-api - DEBUG - API响应: {'status_code': <HTTPStatus.OK: 200>, 'request_id': '95fc53e9-f0c8-9477-9b35-b1c3dee233f1', 'choices': [{'message': Message({'role': 'assistant', 'content': '', 'tool_calls': [{'function': {'name': 'get_current_time', 'arguments': '{}'}, 'index': 0, 'id': 'call_4931f5d2597e4acd9f0b00', 'type': 'function'}]})}], 'usage': {}}
2025-06-08 11:12:24,576 - gongdi-api - DEBUG - 工具调用信息: {'id': 'call_4931f5d2597e4acd9f0b00', 'function_name': 'get_current_time', 'arguments': {}}
2025-06-08 11:12:24,577 - gongdi-api - DEBUG - 执行函数: get_current_time, 参数: {}
2025-06-08 11:12:24,577 - gongdi-api - DEBUG - 函数执行结果: {'datetime': '2025-06-08 11:12:24', 'date': '2025-06-08', 'time': '11:12:24', 'weekday': 'Sunday'}
2025-06-08 11:12:24,578 - gongdi-api - DEBUG - 将函数调用结果返回给模型处理
2025-06-08 11:12:24,579 - gongdi-api - DEBUG - 发送给模型的完整消息: [{"role": "user", "content": "时间"}, {"role": "assistant", "content": "", "tool_calls": [{"function": {"name": "get_current_time", "arguments": "{}"}, "index": 0, "id": "call_4931f5d2597e4acd9f0b00", "type": "function"}]}, {"tool_call_id": "call_4931f5d2597e4acd9f0b00", "role": "tool", "content": "{\"datetime\": \"2025-06-08 11:12:24\", \"date\": \"2025-06-08\", \"time\": \"11:12:24\", \"weekday\": \"Sunday\"}"}]
2025-06-08 11:12:24,581 - gongdi-api.dashscope - DEBUG - DashscopeClient初始化: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 11:12:24,582 - dashscope - DEBUG - Request body: {'model': 'qwen-turbo', 'parameters': {'temperature': 0, 'max_tokens': 2048, 'result_format': 'message'}, 'input': {'messages': [{'role': 'user', 'content': '时间'}, {'role': 'assistant', 'content': '', 'tool_calls': [{'function': {'name': 'get_current_time', 'arguments': '{}'}, 'index': 0, 'id': 'call_4931f5d2597e4acd9f0b00', 'type': 'function'}]}, {'tool_call_id': 'call_4931f5d2597e4acd9f0b00', 'role': 'tool', 'content': '{"datetime": "2025-06-08 11:12:24", "date": "2025-06-08", "time": "11:12:24", "weekday": "Sunday"}'}]}}
2025-06-08 11:12:24,587 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): dashscope.aliyuncs.com:443
2025-06-08 11:12:27,820 - urllib3.connectionpool - DEBUG - https://dashscope.aliyuncs.com:443 "POST /api/v1/services/aigc/text-generation/generation HTTP/1.1" 200 None
2025-06-08 11:12:27,823 - dashscope - DEBUG - Response: {'output': {'choices': [{'finish_reason': 'stop', 'message': {'role': 'assistant', 'content': "The given data provides the following information about the time:\n\n- **Full datetime**: June 8, 2025, at 11:12:24 AM\n- **Date**: June 8, 2025\n- **Time**: 11:12:24 AM\n- **Weekday**: Sunday\n\nIs there anything specific you would like to know or any particular operation you'd like to perform with this time data?"}}]}, 'usage': {'total_tokens': 176, 'output_tokens': 97, 'input_tokens': 79, 'prompt_tokens_details': {'cached_tokens': 0}}, 'request_id': '4e403c0b-75cf-9b23-95c7-93ea4c4669c5'}
2025-06-08 11:12:27,829 - gongdi-api - DEBUG - 模型最终响应: {'status_code': <HTTPStatus.OK: 200>, 'request_id': '4e403c0b-75cf-9b23-95c7-93ea4c4669c5', 'choices': [{'message': {'content': "The given data provides the following information about the time:\n\n- **Full datetime**: June 8, 2025, at 11:12:24 AM\n- **Date**: June 8, 2025\n- **Time**: 11:12:24 AM\n- **Weekday**: Sunday\n\nIs there anything specific you would like to know or any particular operation you'd like to perform with this time data?", 'role': 'assistant'}}], 'usage': {}}
2025-06-08 11:12:27,831 - gongdi-api - DEBUG - 最终返回结果: {'status_code': <HTTPStatus.OK: 200>, 'request_id': '95fc53e9-f0c8-9477-9b35-b1c3dee233f1', 'message': Message({'role': 'assistant', 'content': '', 'tool_calls': [{'function': {'name': 'get_current_time', 'arguments': '{}'}, 'index': 0, 'id': 'call_4931f5d2597e4acd9f0b00', 'type': 'function'}]}), 'tool_calls': [{'id': 'call_4931f5d2597e4acd9f0b00', 'function_name': 'get_current_time', 'arguments': {}}], 'executed_results': [{'id': 'call_4931f5d2597e4acd9f0b00', 'function_name': 'get_current_time', 'success': True, 'result': {'datetime': '2025-06-08 11:12:24', 'date': '2025-06-08', 'time': '11:12:24', 'weekday': 'Sunday'}}], 'final_answer': "The given data provides the following information about the time:\n\n- **Full datetime**: June 8, 2025, at 11:12:24 AM\n- **Date**: June 8, 2025\n- **Time**: 11:12:24 AM\n- **Weekday**: Sunday\n\nIs there anything specific you would like to know or any particular operation you'd like to perform with this time data?"}
2025-06-08 11:15:13,973 - gongdi-api - DEBUG - 接收到函数调用请求: {'query': '??????', 'tools': None}
2025-06-08 11:15:13,974 - gongdi-api - DEBUG - 使用默认工具: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 11:15:13,975 - gongdi-api - DEBUG - 调用DashscopeClient处理请求，query: ??????
2025-06-08 11:15:13,975 - gongdi-api.dashscope - DEBUG - DashscopeClient初始化: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 11:15:13,976 - gongdi-api.dashscope - DEBUG - 接收function_call请求: messages=[{'role': 'user', 'content': '??????'}]
2025-06-08 11:15:13,978 - gongdi-api.dashscope - DEBUG - 原始工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 11:15:13,979 - gongdi-api.dashscope - DEBUG - 格式化后的工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 11:15:13,980 - gongdi-api.dashscope - DEBUG - 调用DashScope API参数: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 11:15:13,981 - gongdi-api.dashscope - DEBUG - 开始调用DashScope API...
2025-06-08 11:15:13,982 - dashscope - DEBUG - Request body: {'model': 'qwen-turbo', 'parameters': {'tools': [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}], 'temperature': 0, 'max_tokens': 2048, 'result_format': 'message'}, 'input': {'messages': [{'role': 'user', 'content': '??????'}]}}
2025-06-08 11:15:13,987 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): dashscope.aliyuncs.com:443
2025-06-08 11:15:16,416 - urllib3.connectionpool - DEBUG - https://dashscope.aliyuncs.com:443 "POST /api/v1/services/aigc/text-generation/generation HTTP/1.1" 200 None
2025-06-08 11:15:16,417 - dashscope - DEBUG - Response: {'output': {'choices': [{'finish_reason': 'stop', 'message': {'role': 'assistant', 'content': '您好！看起来您可能有具体的问题或需求需要帮助。请告诉我您想了解什么信息或者需要解决什么问题？这样我可以更好地为您提供支持。'}}]}, 'usage': {'total_tokens': 255, 'output_tokens': 32, 'input_tokens': 223, 'prompt_tokens_details': {'cached_tokens': 0}}, 'request_id': 'd186fe4c-8c5c-974b-931b-5fd05eba1d65'}
2025-06-08 11:15:16,421 - gongdi-api.dashscope - DEBUG - DashScope API响应状态码: 200
2025-06-08 11:15:16,421 - gongdi-api.dashscope - DEBUG - 成功处理响应: request_id=d186fe4c-8c5c-974b-931b-5fd05eba1d65
2025-06-08 11:15:16,422 - gongdi-api - DEBUG - API响应: {'status_code': <HTTPStatus.OK: 200>, 'request_id': 'd186fe4c-8c5c-974b-931b-5fd05eba1d65', 'choices': [{'message': Message({'role': 'assistant', 'content': '您好！看起来您可能有具体的问题或需求需要帮助。请告诉我您想了解什么信息或者需要解决什么问题？这样我可以更好地为您提供支持。'})}], 'usage': {}}
2025-06-08 11:15:16,423 - gongdi-api - DEBUG - 响应中没有工具调用
2025-06-08 11:15:18,340 - gongdi-api - DEBUG - 接收到函数调用请求: {'query': '??????', 'tools': None}
2025-06-08 11:15:18,341 - gongdi-api - DEBUG - 使用默认工具: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 11:15:18,342 - gongdi-api - DEBUG - 调用DashscopeClient处理请求，query: ??????
2025-06-08 11:15:18,343 - gongdi-api.dashscope - DEBUG - DashscopeClient初始化: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 11:15:18,343 - gongdi-api.dashscope - DEBUG - 接收function_call请求: messages=[{'role': 'user', 'content': '??????'}]
2025-06-08 11:15:18,344 - gongdi-api.dashscope - DEBUG - 原始工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 11:15:18,345 - gongdi-api.dashscope - DEBUG - 格式化后的工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 11:15:18,346 - gongdi-api.dashscope - DEBUG - 调用DashScope API参数: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 11:15:18,347 - gongdi-api.dashscope - DEBUG - 开始调用DashScope API...
2025-06-08 11:15:18,348 - dashscope - DEBUG - Request body: {'model': 'qwen-turbo', 'parameters': {'tools': [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}], 'temperature': 0, 'max_tokens': 2048, 'result_format': 'message'}, 'input': {'messages': [{'role': 'user', 'content': '??????'}]}}
2025-06-08 11:15:18,352 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): dashscope.aliyuncs.com:443
2025-06-08 11:15:20,966 - urllib3.connectionpool - DEBUG - https://dashscope.aliyuncs.com:443 "POST /api/v1/services/aigc/text-generation/generation HTTP/1.1" 200 None
2025-06-08 11:15:20,968 - dashscope - DEBUG - Response: {'output': {'choices': [{'finish_reason': 'stop', 'message': {'role': 'assistant', 'content': '您好！看起来您可能有具体的问题或需求需要帮助。请告诉我您想了解什么信息或者需要解决什么问题？这样我可以更好地为您提供支持。'}}]}, 'usage': {'total_tokens': 255, 'output_tokens': 32, 'input_tokens': 223, 'prompt_tokens_details': {'cached_tokens': 0}}, 'request_id': '80cd8c2a-f95f-9b49-ab71-e3aef00b3836'}
2025-06-08 11:15:20,975 - gongdi-api.dashscope - DEBUG - DashScope API响应状态码: 200
2025-06-08 11:15:20,975 - gongdi-api.dashscope - DEBUG - 成功处理响应: request_id=80cd8c2a-f95f-9b49-ab71-e3aef00b3836
2025-06-08 11:15:20,976 - gongdi-api - DEBUG - API响应: {'status_code': <HTTPStatus.OK: 200>, 'request_id': '80cd8c2a-f95f-9b49-ab71-e3aef00b3836', 'choices': [{'message': Message({'role': 'assistant', 'content': '您好！看起来您可能有具体的问题或需求需要帮助。请告诉我您想了解什么信息或者需要解决什么问题？这样我可以更好地为您提供支持。'})}], 'usage': {}}
2025-06-08 11:15:20,977 - gongdi-api - DEBUG - 响应中没有工具调用
2025-06-08 11:15:31,825 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:15:31,830 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:15:38,341 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:15:38,383 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:15:42,040 - asyncio - DEBUG - Using selector: SelectSelector
2025-06-08 11:15:50,998 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:15:51,885 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:15:51,907 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:15:52,115 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:15:53,010 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:15:53,826 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:15:53,972 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:15:54,280 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:15:55,980 - asyncio - DEBUG - Using selector: SelectSelector
2025-06-08 11:15:56,593 - gongdi-api - DEBUG - 接收到函数调用请求: {'query': '现在几点了？', 'tools': None}
2025-06-08 11:15:56,594 - gongdi-api - DEBUG - 使用默认工具: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 11:15:56,596 - gongdi-api - DEBUG - 调用DashscopeClient处理请求，query: 现在几点了？
2025-06-08 11:15:56,597 - gongdi-api.dashscope - DEBUG - DashscopeClient初始化: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 11:15:56,599 - gongdi-api.dashscope - DEBUG - 接收function_call请求: messages=[{'role': 'user', 'content': '现在几点了？'}]
2025-06-08 11:15:56,600 - gongdi-api.dashscope - DEBUG - 原始工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 11:15:56,603 - gongdi-api.dashscope - DEBUG - 格式化后的工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 11:15:56,605 - gongdi-api.dashscope - DEBUG - 调用DashScope API参数: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 11:15:56,606 - gongdi-api.dashscope - DEBUG - 开始调用DashScope API...
2025-06-08 11:15:56,717 - dashscope - DEBUG - Request body: {'model': 'qwen-turbo', 'parameters': {'tools': [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}], 'temperature': 0, 'max_tokens': 2048, 'result_format': 'message'}, 'input': {'messages': [{'role': 'user', 'content': '现在几点了？'}]}}
2025-06-08 11:15:56,728 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): dashscope.aliyuncs.com:443
2025-06-08 11:15:58,916 - urllib3.connectionpool - DEBUG - https://dashscope.aliyuncs.com:443 "POST /api/v1/services/aigc/text-generation/generation HTTP/1.1" 200 None
2025-06-08 11:15:58,919 - dashscope - DEBUG - Response: {'output': {'choices': [{'finish_reason': 'tool_calls', 'message': {'role': 'assistant', 'tool_calls': [{'function': {'name': 'get_current_time', 'arguments': '{}'}, 'index': 0, 'id': 'call_3dcb8bd7347b43fb824337', 'type': 'function'}], 'content': ''}}]}, 'usage': {'total_tokens': 238, 'output_tokens': 13, 'input_tokens': 225, 'prompt_tokens_details': {'cached_tokens': 128}}, 'request_id': '423bbcd4-62e8-93fb-a6d7-43ab09bd1194'}
2025-06-08 11:15:58,922 - gongdi-api.dashscope - DEBUG - DashScope API响应状态码: 200
2025-06-08 11:15:58,922 - gongdi-api.dashscope - DEBUG - 成功处理响应: request_id=423bbcd4-62e8-93fb-a6d7-43ab09bd1194
2025-06-08 11:15:58,923 - gongdi-api - DEBUG - API响应: {'status_code': <HTTPStatus.OK: 200>, 'request_id': '423bbcd4-62e8-93fb-a6d7-43ab09bd1194', 'choices': [{'message': Message({'role': 'assistant', 'content': '', 'tool_calls': [{'function': {'name': 'get_current_time', 'arguments': '{}'}, 'index': 0, 'id': 'call_3dcb8bd7347b43fb824337', 'type': 'function'}]})}], 'usage': {}}
2025-06-08 11:15:58,924 - gongdi-api - DEBUG - 工具调用信息: {'id': 'call_3dcb8bd7347b43fb824337', 'function_name': 'get_current_time', 'arguments': {}}
2025-06-08 11:15:58,924 - gongdi-api - DEBUG - 执行函数: get_current_time, 参数: {}
2025-06-08 11:15:58,925 - gongdi-api - DEBUG - 函数执行结果: {'datetime': '2025-06-08 11:15:58', 'date': '2025-06-08', 'time': '11:15:58', 'weekday': 'Sunday'}
2025-06-08 11:15:58,925 - gongdi-api - DEBUG - 将函数调用结果返回给模型处理
2025-06-08 11:15:58,926 - gongdi-api - DEBUG - 发送给模型的完整消息: [{"role": "user", "content": "现在几点了？"}, {"role": "assistant", "content": "", "tool_calls": [{"function": {"name": "get_current_time", "arguments": "{}"}, "index": 0, "id": "call_3dcb8bd7347b43fb824337", "type": "function"}]}, {"tool_call_id": "call_3dcb8bd7347b43fb824337", "role": "tool", "content": "{\"datetime\": \"2025-06-08 11:15:58\", \"date\": \"2025-06-08\", \"time\": \"11:15:58\", \"weekday\": \"Sunday\"}"}]
2025-06-08 11:15:58,927 - gongdi-api.dashscope - DEBUG - DashscopeClient初始化: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 11:15:58,927 - dashscope - DEBUG - Request body: {'model': 'qwen-turbo', 'parameters': {'temperature': 0, 'max_tokens': 2048, 'result_format': 'message'}, 'input': {'messages': [{'role': 'user', 'content': '现在几点了？'}, {'role': 'assistant', 'content': '', 'tool_calls': [{'function': {'name': 'get_current_time', 'arguments': '{}'}, 'index': 0, 'id': 'call_3dcb8bd7347b43fb824337', 'type': 'function'}]}, {'tool_call_id': 'call_3dcb8bd7347b43fb824337', 'role': 'tool', 'content': '{"datetime": "2025-06-08 11:15:58", "date": "2025-06-08", "time": "11:15:58", "weekday": "Sunday"}'}]}}
2025-06-08 11:15:58,930 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): dashscope.aliyuncs.com:443
2025-06-08 11:16:01,351 - urllib3.connectionpool - DEBUG - https://dashscope.aliyuncs.com:443 "POST /api/v1/services/aigc/text-generation/generation HTTP/1.1" 200 None
2025-06-08 11:16:01,353 - dashscope - DEBUG - Response: {'output': {'choices': [{'finish_reason': 'stop', 'message': {'role': 'assistant', 'content': '现在的时间是2025年6月8日，星期日，上午11点15分58秒。'}}]}, 'usage': {'total_tokens': 108, 'output_tokens': 27, 'input_tokens': 81, 'prompt_tokens_details': {'cached_tokens': 0}}, 'request_id': 'a260ccc3-827b-9b64-8d86-f604cf403834'}
2025-06-08 11:16:01,357 - gongdi-api - DEBUG - 模型最终响应: {'status_code': <HTTPStatus.OK: 200>, 'request_id': 'a260ccc3-827b-9b64-8d86-f604cf403834', 'choices': [{'message': {'content': '现在的时间是2025年6月8日，星期日，上午11点15分58秒。', 'role': 'assistant'}}], 'usage': {}}
2025-06-08 11:16:01,357 - gongdi-api - DEBUG - 最终返回结果: {'status_code': <HTTPStatus.OK: 200>, 'request_id': '423bbcd4-62e8-93fb-a6d7-43ab09bd1194', 'message': Message({'role': 'assistant', 'content': '', 'tool_calls': [{'function': {'name': 'get_current_time', 'arguments': '{}'}, 'index': 0, 'id': 'call_3dcb8bd7347b43fb824337', 'type': 'function'}]}), 'tool_calls': [{'id': 'call_3dcb8bd7347b43fb824337', 'function_name': 'get_current_time', 'arguments': {}}], 'executed_results': [{'id': 'call_3dcb8bd7347b43fb824337', 'function_name': 'get_current_time', 'success': True, 'result': {'datetime': '2025-06-08 11:15:58', 'date': '2025-06-08', 'time': '11:15:58', 'weekday': 'Sunday'}}], 'final_answer': '现在的时间是2025年6月8日，星期日，上午11点15分58秒。'}
2025-06-08 11:16:23,388 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:16:23,452 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:16:24,636 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:16:27,010 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:16:27,126 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:16:27,523 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:16:27,828 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:16:28,482 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:16:29,787 - asyncio - DEBUG - Using selector: SelectSelector
2025-06-08 11:16:31,857 - gongdi-api - DEBUG - 接收到函数调用请求: {'query': '现在几点了？', 'tools': None}
2025-06-08 11:16:31,860 - gongdi-api - DEBUG - 使用默认工具: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 11:16:31,863 - gongdi-api - DEBUG - 调用DashscopeClient处理请求，query: 现在几点了？
2025-06-08 11:16:31,864 - gongdi-api.dashscope - DEBUG - DashscopeClient初始化: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 11:16:31,866 - gongdi-api.dashscope - DEBUG - 接收function_call请求: messages=[{'role': 'user', 'content': '现在几点了？'}]
2025-06-08 11:16:31,875 - gongdi-api.dashscope - DEBUG - 原始工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 11:16:31,877 - gongdi-api.dashscope - DEBUG - 格式化后的工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 11:16:31,879 - gongdi-api.dashscope - DEBUG - 调用DashScope API参数: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 11:16:31,879 - gongdi-api.dashscope - DEBUG - 开始调用DashScope API...
2025-06-08 11:16:32,005 - dashscope - DEBUG - Request body: {'model': 'qwen-turbo', 'parameters': {'tools': [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}], 'temperature': 0, 'max_tokens': 2048, 'result_format': 'message'}, 'input': {'messages': [{'role': 'user', 'content': '现在几点了？'}]}}
2025-06-08 11:16:32,015 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): dashscope.aliyuncs.com:443
2025-06-08 11:16:34,205 - urllib3.connectionpool - DEBUG - https://dashscope.aliyuncs.com:443 "POST /api/v1/services/aigc/text-generation/generation HTTP/1.1" 200 None
2025-06-08 11:16:34,207 - dashscope - DEBUG - Response: {'output': {'choices': [{'finish_reason': 'tool_calls', 'message': {'role': 'assistant', 'tool_calls': [{'function': {'name': 'get_current_time', 'arguments': '{}'}, 'index': 0, 'id': 'call_67b0043324644dc2942ff7', 'type': 'function'}], 'content': ''}}]}, 'usage': {'total_tokens': 238, 'output_tokens': 13, 'input_tokens': 225, 'prompt_tokens_details': {'cached_tokens': 128}}, 'request_id': '145eb902-72c3-95a5-a346-51bdc2bb9ad8'}
2025-06-08 11:16:34,214 - gongdi-api.dashscope - DEBUG - DashScope API响应状态码: 200
2025-06-08 11:16:34,215 - gongdi-api.dashscope - DEBUG - 成功处理响应: request_id=145eb902-72c3-95a5-a346-51bdc2bb9ad8
2025-06-08 11:16:34,216 - gongdi-api - DEBUG - API响应: {'status_code': <HTTPStatus.OK: 200>, 'request_id': '145eb902-72c3-95a5-a346-51bdc2bb9ad8', 'choices': [{'message': Message({'role': 'assistant', 'content': '', 'tool_calls': [{'function': {'name': 'get_current_time', 'arguments': '{}'}, 'index': 0, 'id': 'call_67b0043324644dc2942ff7', 'type': 'function'}]})}], 'usage': {}}
2025-06-08 11:16:34,217 - gongdi-api - DEBUG - 工具调用信息: {'id': 'call_67b0043324644dc2942ff7', 'function_name': 'get_current_time', 'arguments': {}}
2025-06-08 11:16:34,218 - gongdi-api - DEBUG - 执行函数: get_current_time, 参数: {}
2025-06-08 11:16:34,218 - gongdi-api - DEBUG - 函数执行结果: {'datetime': '2025-06-08 11:16:34', 'date': '2025-06-08', 'time': '11:16:34', 'weekday': 'Sunday'}
2025-06-08 11:16:34,219 - gongdi-api - DEBUG - 将函数调用结果返回给模型处理
2025-06-08 11:16:34,219 - gongdi-api - DEBUG - 发送给模型的完整消息: [{"role": "user", "content": "现在几点了？"}, {"role": "assistant", "content": "", "tool_calls": [{"function": {"name": "get_current_time", "arguments": "{}"}, "index": 0, "id": "call_67b0043324644dc2942ff7", "type": "function"}]}, {"tool_call_id": "call_67b0043324644dc2942ff7", "role": "tool", "content": "{\"datetime\": \"2025-06-08 11:16:34\", \"date\": \"2025-06-08\", \"time\": \"11:16:34\", \"weekday\": \"Sunday\"}"}]
2025-06-08 11:16:34,221 - gongdi-api.dashscope - DEBUG - DashscopeClient初始化: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 11:16:34,222 - dashscope - DEBUG - Request body: {'model': 'qwen-turbo', 'parameters': {'temperature': 0, 'max_tokens': 2048, 'result_format': 'message'}, 'input': {'messages': [{'role': 'user', 'content': '现在几点了？'}, {'role': 'assistant', 'content': '', 'tool_calls': [{'function': {'name': 'get_current_time', 'arguments': '{}'}, 'index': 0, 'id': 'call_67b0043324644dc2942ff7', 'type': 'function'}]}, {'tool_call_id': 'call_67b0043324644dc2942ff7', 'role': 'tool', 'content': '{"datetime": "2025-06-08 11:16:34", "date": "2025-06-08", "time": "11:16:34", "weekday": "Sunday"}'}]}}
2025-06-08 11:16:34,226 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): dashscope.aliyuncs.com:443
2025-06-08 11:16:36,682 - urllib3.connectionpool - DEBUG - https://dashscope.aliyuncs.com:443 "POST /api/v1/services/aigc/text-generation/generation HTTP/1.1" 200 None
2025-06-08 11:16:36,684 - dashscope - DEBUG - Response: {'output': {'choices': [{'finish_reason': 'stop', 'message': {'role': 'assistant', 'content': '现在的时间是2025年6月8日，星期日，上午11点16分34秒。'}}]}, 'usage': {'total_tokens': 108, 'output_tokens': 27, 'input_tokens': 81, 'prompt_tokens_details': {'cached_tokens': 0}}, 'request_id': '814261ff-f5b9-98aa-892e-8fc523a3652f'}
2025-06-08 11:16:36,690 - gongdi-api - DEBUG - 模型最终响应: {'status_code': <HTTPStatus.OK: 200>, 'request_id': '814261ff-f5b9-98aa-892e-8fc523a3652f', 'choices': [{'message': {'content': '现在的时间是2025年6月8日，星期日，上午11点16分34秒。', 'role': 'assistant'}}], 'usage': {}}
2025-06-08 11:16:36,692 - gongdi-api - DEBUG - 最终返回结果: {'status_code': <HTTPStatus.OK: 200>, 'request_id': '145eb902-72c3-95a5-a346-51bdc2bb9ad8', 'message': Message({'role': 'assistant', 'content': '', 'tool_calls': [{'function': {'name': 'get_current_time', 'arguments': '{}'}, 'index': 0, 'id': 'call_67b0043324644dc2942ff7', 'type': 'function'}]}), 'tool_calls': [{'id': 'call_67b0043324644dc2942ff7', 'function_name': 'get_current_time', 'arguments': {}}], 'executed_results': [{'id': 'call_67b0043324644dc2942ff7', 'function_name': 'get_current_time', 'success': True, 'result': {'datetime': '2025-06-08 11:16:34', 'date': '2025-06-08', 'time': '11:16:34', 'weekday': 'Sunday'}}], 'final_answer': '现在的时间是2025年6月8日，星期日，上午11点16分34秒。'}
2025-06-08 11:17:15,196 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:17:15,289 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:17:15,482 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:17:15,609 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:17:15,810 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:17:15,835 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:17:16,226 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:17:16,714 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:17:19,935 - asyncio - DEBUG - Using selector: SelectSelector
2025-06-08 11:17:20,296 - gongdi-api - DEBUG - 接收到函数调用请求: {'query': '现在几点了？', 'tools': None}
2025-06-08 11:17:20,296 - gongdi-api - DEBUG - 使用默认工具: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 11:17:20,297 - gongdi-api - DEBUG - 调用DashscopeClient处理请求，query: 现在几点了？
2025-06-08 11:17:20,298 - gongdi-api.dashscope - DEBUG - DashscopeClient初始化: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 11:17:20,299 - gongdi-api.dashscope - DEBUG - 接收function_call请求: messages=[{'role': 'user', 'content': '现在几点了？'}]
2025-06-08 11:17:20,299 - gongdi-api.dashscope - DEBUG - 原始工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 11:17:20,301 - gongdi-api.dashscope - DEBUG - 格式化后的工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 11:17:20,302 - gongdi-api.dashscope - DEBUG - 调用DashScope API参数: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 11:17:20,302 - gongdi-api.dashscope - DEBUG - 开始调用DashScope API...
2025-06-08 11:17:20,455 - dashscope - DEBUG - Request body: {'model': 'qwen-turbo', 'parameters': {'tools': [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}], 'temperature': 0, 'max_tokens': 2048, 'result_format': 'message'}, 'input': {'messages': [{'role': 'user', 'content': '现在几点了？'}]}}
2025-06-08 11:17:20,465 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): dashscope.aliyuncs.com:443
2025-06-08 11:17:22,682 - urllib3.connectionpool - DEBUG - https://dashscope.aliyuncs.com:443 "POST /api/v1/services/aigc/text-generation/generation HTTP/1.1" 200 None
2025-06-08 11:17:22,684 - dashscope - DEBUG - Response: {'output': {'choices': [{'finish_reason': 'tool_calls', 'message': {'role': 'assistant', 'tool_calls': [{'function': {'name': 'get_current_time', 'arguments': '{}'}, 'index': 0, 'id': 'call_a3c0e8a20e974831ab4c9a', 'type': 'function'}], 'content': ''}}]}, 'usage': {'total_tokens': 238, 'output_tokens': 13, 'input_tokens': 225, 'prompt_tokens_details': {'cached_tokens': 0}}, 'request_id': '275313b1-7cb0-9549-b3fe-0f95039005b1'}
2025-06-08 11:17:22,691 - gongdi-api.dashscope - DEBUG - DashScope API响应状态码: 200
2025-06-08 11:17:22,692 - gongdi-api.dashscope - DEBUG - 成功处理响应: request_id=275313b1-7cb0-9549-b3fe-0f95039005b1
2025-06-08 11:17:22,692 - gongdi-api - DEBUG - API响应: {'status_code': <HTTPStatus.OK: 200>, 'request_id': '275313b1-7cb0-9549-b3fe-0f95039005b1', 'choices': [{'message': Message({'role': 'assistant', 'content': '', 'tool_calls': [{'function': {'name': 'get_current_time', 'arguments': '{}'}, 'index': 0, 'id': 'call_a3c0e8a20e974831ab4c9a', 'type': 'function'}]})}], 'usage': {}}
2025-06-08 11:17:22,693 - gongdi-api - DEBUG - 工具调用信息: {'id': 'call_a3c0e8a20e974831ab4c9a', 'function_name': 'get_current_time', 'arguments': {}}
2025-06-08 11:17:22,694 - gongdi-api - DEBUG - 执行函数: get_current_time, 参数: {}
2025-06-08 11:17:22,695 - gongdi-api - DEBUG - 函数执行结果: {'datetime': '2025-06-08 11:17:22', 'date': '2025-06-08', 'time': '11:17:22', 'weekday': 'Sunday'}
2025-06-08 11:17:22,696 - gongdi-api - DEBUG - 将函数调用结果返回给模型处理
2025-06-08 11:17:22,697 - gongdi-api - DEBUG - 发送给模型的完整消息: [{"role": "user", "content": "现在几点了？"}, {"role": "assistant", "content": "", "tool_calls": [{"function": {"name": "get_current_time", "arguments": "{}"}, "index": 0, "id": "call_a3c0e8a20e974831ab4c9a", "type": "function"}]}, {"tool_call_id": "call_a3c0e8a20e974831ab4c9a", "role": "tool", "content": "{\"datetime\": \"2025-06-08 11:17:22\", \"date\": \"2025-06-08\", \"time\": \"11:17:22\", \"weekday\": \"Sunday\"}"}]
2025-06-08 11:17:22,698 - gongdi-api.dashscope - DEBUG - DashscopeClient初始化: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 11:17:22,699 - dashscope - DEBUG - Request body: {'model': 'qwen-turbo', 'parameters': {'temperature': 0, 'max_tokens': 2048, 'result_format': 'message'}, 'input': {'messages': [{'role': 'user', 'content': '现在几点了？'}, {'role': 'assistant', 'content': '', 'tool_calls': [{'function': {'name': 'get_current_time', 'arguments': '{}'}, 'index': 0, 'id': 'call_a3c0e8a20e974831ab4c9a', 'type': 'function'}]}, {'tool_call_id': 'call_a3c0e8a20e974831ab4c9a', 'role': 'tool', 'content': '{"datetime": "2025-06-08 11:17:22", "date": "2025-06-08", "time": "11:17:22", "weekday": "Sunday"}'}]}}
2025-06-08 11:17:22,703 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): dashscope.aliyuncs.com:443
2025-06-08 11:17:24,989 - urllib3.connectionpool - DEBUG - https://dashscope.aliyuncs.com:443 "POST /api/v1/services/aigc/text-generation/generation HTTP/1.1" 200 None
2025-06-08 11:17:24,992 - dashscope - DEBUG - Response: {'output': {'choices': [{'finish_reason': 'stop', 'message': {'role': 'assistant', 'content': '现在的时间是2025年6月8日，星期日，上午11点17分22秒。'}}]}, 'usage': {'total_tokens': 108, 'output_tokens': 27, 'input_tokens': 81, 'prompt_tokens_details': {'cached_tokens': 0}}, 'request_id': '85f235b9-8cbe-9649-a51b-cbf796eeabb8'}
2025-06-08 11:17:24,996 - gongdi-api - DEBUG - 模型最终响应: {'status_code': <HTTPStatus.OK: 200>, 'request_id': '85f235b9-8cbe-9649-a51b-cbf796eeabb8', 'choices': [{'message': {'content': '现在的时间是2025年6月8日，星期日，上午11点17分22秒。', 'role': 'assistant'}}], 'usage': {}}
2025-06-08 11:17:24,997 - gongdi-api - DEBUG - 最终返回结果: {'status_code': <HTTPStatus.OK: 200>, 'request_id': '275313b1-7cb0-9549-b3fe-0f95039005b1', 'message': Message({'role': 'assistant', 'content': '', 'tool_calls': [{'function': {'name': 'get_current_time', 'arguments': '{}'}, 'index': 0, 'id': 'call_a3c0e8a20e974831ab4c9a', 'type': 'function'}]}), 'tool_calls': [{'id': 'call_a3c0e8a20e974831ab4c9a', 'function_name': 'get_current_time', 'arguments': {}}], 'executed_results': [{'id': 'call_a3c0e8a20e974831ab4c9a', 'function_name': 'get_current_time', 'success': True, 'result': {'datetime': '2025-06-08 11:17:22', 'date': '2025-06-08', 'time': '11:17:22', 'weekday': 'Sunday'}}], 'final_answer': '现在的时间是2025年6月8日，星期日，上午11点17分22秒。'}
2025-06-08 11:18:13,382 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:18:13,437 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:18:13,936 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:18:13,934 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:18:14,714 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:18:14,731 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:18:14,782 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:18:15,774 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:18:18,217 - asyncio - DEBUG - Using selector: SelectSelector
2025-06-08 11:18:18,627 - gongdi-api - DEBUG - 接收到函数调用请求: {'query': '现在几点了？', 'tools': None}
2025-06-08 11:18:18,628 - gongdi-api - DEBUG - 使用默认工具: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 11:18:18,629 - gongdi-api - DEBUG - 调用DashscopeClient处理请求，query: 现在几点了？
2025-06-08 11:18:18,630 - gongdi-api.dashscope - DEBUG - DashscopeClient初始化: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 11:18:18,631 - gongdi-api.dashscope - DEBUG - 接收function_call请求: messages=[{'role': 'user', 'content': '现在几点了？'}]
2025-06-08 11:18:18,631 - gongdi-api.dashscope - DEBUG - 原始工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 11:18:18,632 - gongdi-api.dashscope - DEBUG - 格式化后的工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 11:18:18,633 - gongdi-api.dashscope - DEBUG - 调用DashScope API参数: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 11:18:18,634 - gongdi-api.dashscope - DEBUG - 开始调用DashScope API...
2025-06-08 11:18:18,904 - dashscope - DEBUG - Request body: {'model': 'qwen-turbo', 'parameters': {'tools': [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}], 'temperature': 0, 'max_tokens': 2048, 'result_format': 'message'}, 'input': {'messages': [{'role': 'user', 'content': '现在几点了？'}]}}
2025-06-08 11:18:18,914 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): dashscope.aliyuncs.com:443
2025-06-08 11:18:21,102 - urllib3.connectionpool - DEBUG - https://dashscope.aliyuncs.com:443 "POST /api/v1/services/aigc/text-generation/generation HTTP/1.1" 200 None
2025-06-08 11:18:21,105 - dashscope - DEBUG - Response: {'output': {'choices': [{'finish_reason': 'tool_calls', 'message': {'role': 'assistant', 'tool_calls': [{'function': {'name': 'get_current_time', 'arguments': '{}'}, 'index': 0, 'id': 'call_3435cc24ade046e1bdb64b', 'type': 'function'}], 'content': ''}}]}, 'usage': {'total_tokens': 238, 'output_tokens': 13, 'input_tokens': 225, 'prompt_tokens_details': {'cached_tokens': 0}}, 'request_id': '74d05e9e-593b-99ad-be76-e2a09d65cc85'}
2025-06-08 11:18:21,111 - gongdi-api.dashscope - DEBUG - DashScope API响应状态码: 200
2025-06-08 11:18:21,112 - gongdi-api.dashscope - DEBUG - 成功处理响应: request_id=74d05e9e-593b-99ad-be76-e2a09d65cc85
2025-06-08 11:18:21,113 - gongdi-api - DEBUG - API响应: {'status_code': <HTTPStatus.OK: 200>, 'request_id': '74d05e9e-593b-99ad-be76-e2a09d65cc85', 'choices': [{'message': Message({'role': 'assistant', 'content': '', 'tool_calls': [{'function': {'name': 'get_current_time', 'arguments': '{}'}, 'index': 0, 'id': 'call_3435cc24ade046e1bdb64b', 'type': 'function'}]})}], 'usage': {}}
2025-06-08 11:18:21,114 - gongdi-api - DEBUG - 工具调用信息: {'id': 'call_3435cc24ade046e1bdb64b', 'function_name': 'get_current_time', 'arguments': {}}
2025-06-08 11:18:21,115 - gongdi-api - DEBUG - 执行函数: get_current_time, 参数: {}
2025-06-08 11:18:21,115 - gongdi-api - DEBUG - 函数执行结果: {'datetime': '2025-06-08 11:18:21', 'date': '2025-06-08', 'time': '11:18:21', 'weekday': 'Sunday'}
2025-06-08 11:18:21,116 - gongdi-api - DEBUG - 将函数调用结果返回给模型处理
2025-06-08 11:18:21,117 - gongdi-api - DEBUG - 发送给模型的完整消息: [{"role": "user", "content": "现在几点了？"}, {"role": "assistant", "content": "", "tool_calls": [{"function": {"name": "get_current_time", "arguments": "{}"}, "index": 0, "id": "call_3435cc24ade046e1bdb64b", "type": "function"}]}, {"tool_call_id": "call_3435cc24ade046e1bdb64b", "role": "tool", "content": "{\"datetime\": \"2025-06-08 11:18:21\", \"date\": \"2025-06-08\", \"time\": \"11:18:21\", \"weekday\": \"Sunday\"}"}]
2025-06-08 11:18:21,118 - gongdi-api.dashscope - DEBUG - DashscopeClient初始化: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 11:18:21,119 - dashscope - DEBUG - Request body: {'model': 'qwen-turbo', 'parameters': {'temperature': 0, 'max_tokens': 2048, 'result_format': 'message'}, 'input': {'messages': [{'role': 'user', 'content': '现在几点了？'}, {'role': 'assistant', 'content': '', 'tool_calls': [{'function': {'name': 'get_current_time', 'arguments': '{}'}, 'index': 0, 'id': 'call_3435cc24ade046e1bdb64b', 'type': 'function'}]}, {'tool_call_id': 'call_3435cc24ade046e1bdb64b', 'role': 'tool', 'content': '{"datetime": "2025-06-08 11:18:21", "date": "2025-06-08", "time": "11:18:21", "weekday": "Sunday"}'}]}}
2025-06-08 11:18:21,124 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): dashscope.aliyuncs.com:443
2025-06-08 11:18:23,636 - urllib3.connectionpool - DEBUG - https://dashscope.aliyuncs.com:443 "POST /api/v1/services/aigc/text-generation/generation HTTP/1.1" 200 None
2025-06-08 11:18:23,638 - dashscope - DEBUG - Response: {'output': {'choices': [{'finish_reason': 'stop', 'message': {'role': 'assistant', 'content': '现在的时间是2025年6月8日，星期日，上午11点18分21秒。'}}]}, 'usage': {'total_tokens': 108, 'output_tokens': 27, 'input_tokens': 81, 'prompt_tokens_details': {'cached_tokens': 0}}, 'request_id': '5224c79f-8962-91ac-bebf-7d3224717562'}
2025-06-08 11:18:23,643 - gongdi-api - DEBUG - 模型最终响应: {'status_code': <HTTPStatus.OK: 200>, 'request_id': '5224c79f-8962-91ac-bebf-7d3224717562', 'choices': [{'message': {'content': '现在的时间是2025年6月8日，星期日，上午11点18分21秒。', 'role': 'assistant'}}], 'usage': {}}
2025-06-08 11:18:23,645 - gongdi-api - DEBUG - 最终返回结果: {'status_code': <HTTPStatus.OK: 200>, 'request_id': '74d05e9e-593b-99ad-be76-e2a09d65cc85', 'message': Message({'role': 'assistant', 'content': '', 'tool_calls': [{'function': {'name': 'get_current_time', 'arguments': '{}'}, 'index': 0, 'id': 'call_3435cc24ade046e1bdb64b', 'type': 'function'}]}), 'tool_calls': [{'id': 'call_3435cc24ade046e1bdb64b', 'function_name': 'get_current_time', 'arguments': {}}], 'executed_results': [{'id': 'call_3435cc24ade046e1bdb64b', 'function_name': 'get_current_time', 'success': True, 'result': {'datetime': '2025-06-08 11:18:21', 'date': '2025-06-08', 'time': '11:18:21', 'weekday': 'Sunday'}}], 'final_answer': '现在的时间是2025年6月8日，星期日，上午11点18分21秒。'}
2025-06-08 11:18:57,653 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:18:57,756 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:18:57,961 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:18:58,312 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:18:59,290 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:19:17,377 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:19:17,845 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:19:19,408 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:19:19,419 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:19:19,486 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:19:59,977 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:20:28,905 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:20:28,911 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:20:30,068 - asyncio - DEBUG - Using selector: SelectSelector
2025-06-08 11:21:49,271 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:21:49,314 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:21:49,746 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:21:49,796 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:21:49,835 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:21:50,676 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:21:51,029 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:21:53,015 - asyncio - DEBUG - Using selector: SelectSelector
2025-06-08 11:21:58,598 - gongdi-api - DEBUG - 接收到函数调用请求: {'query': '时间', 'tools': [{}]}
2025-06-08 11:21:58,599 - gongdi-api - DEBUG - 使用默认工具: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 11:21:58,600 - gongdi-api - DEBUG - 调用DashscopeClient处理请求，query: 时间
2025-06-08 11:21:58,601 - gongdi-api.dashscope - DEBUG - DashscopeClient初始化: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 11:21:58,601 - gongdi-api.dashscope - DEBUG - 接收function_call请求: messages=[{'role': 'user', 'content': '时间'}]
2025-06-08 11:21:58,602 - gongdi-api.dashscope - DEBUG - 原始工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 11:21:58,603 - gongdi-api.dashscope - DEBUG - 格式化后的工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 11:21:58,604 - gongdi-api.dashscope - DEBUG - 调用DashScope API参数: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 11:21:58,605 - gongdi-api.dashscope - DEBUG - 开始调用DashScope API...
2025-06-08 11:21:58,695 - dashscope - DEBUG - Request body: {'model': 'qwen-turbo', 'parameters': {'tools': [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}], 'temperature': 0, 'max_tokens': 2048, 'result_format': 'message'}, 'input': {'messages': [{'role': 'user', 'content': '时间'}]}}
2025-06-08 11:21:58,705 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): dashscope.aliyuncs.com:443
2025-06-08 11:22:00,852 - urllib3.connectionpool - DEBUG - https://dashscope.aliyuncs.com:443 "POST /api/v1/services/aigc/text-generation/generation HTTP/1.1" 200 None
2025-06-08 11:22:00,854 - dashscope - DEBUG - Response: {'output': {'choices': [{'finish_reason': 'tool_calls', 'message': {'role': 'assistant', 'tool_calls': [{'function': {'name': 'get_current_time', 'arguments': '{}'}, 'index': 0, 'id': 'call_b60aaa1db6bb47d7893b54', 'type': 'function'}], 'content': ''}}]}, 'usage': {'total_tokens': 235, 'output_tokens': 13, 'input_tokens': 222, 'prompt_tokens_details': {'cached_tokens': 0}}, 'request_id': '0ebe7ed1-1a37-90dc-a425-eb4ca0251967'}
2025-06-08 11:22:00,862 - gongdi-api.dashscope - DEBUG - DashScope API响应状态码: 200
2025-06-08 11:22:00,862 - gongdi-api.dashscope - DEBUG - 成功处理响应: request_id=0ebe7ed1-1a37-90dc-a425-eb4ca0251967
2025-06-08 11:22:00,863 - gongdi-api - DEBUG - API响应: {'status_code': <HTTPStatus.OK: 200>, 'request_id': '0ebe7ed1-1a37-90dc-a425-eb4ca0251967', 'choices': [{'message': Message({'role': 'assistant', 'content': '', 'tool_calls': [{'function': {'name': 'get_current_time', 'arguments': '{}'}, 'index': 0, 'id': 'call_b60aaa1db6bb47d7893b54', 'type': 'function'}]})}], 'usage': {}}
2025-06-08 11:22:00,865 - gongdi-api - DEBUG - 工具调用信息: {'id': 'call_b60aaa1db6bb47d7893b54', 'function_name': 'get_current_time', 'arguments': {}}
2025-06-08 11:22:00,865 - gongdi-api - DEBUG - 执行函数: get_current_time, 参数: {}
2025-06-08 11:22:00,866 - gongdi-api - DEBUG - 函数执行结果: {'datetime': '2025-06-08 11:22:00', 'date': '2025-06-08', 'time': '11:22:00', 'weekday': 'Sunday'}
2025-06-08 11:22:00,867 - gongdi-api - DEBUG - 将函数调用结果返回给模型处理
2025-06-08 11:22:00,868 - gongdi-api - DEBUG - 发送给模型的完整消息: [{"role": "user", "content": "时间"}, {"role": "assistant", "content": "", "tool_calls": [{"function": {"name": "get_current_time", "arguments": "{}"}, "index": 0, "id": "call_b60aaa1db6bb47d7893b54", "type": "function"}]}, {"tool_call_id": "call_b60aaa1db6bb47d7893b54", "role": "tool", "content": "{\"datetime\": \"2025-06-08 11:22:00\", \"date\": \"2025-06-08\", \"time\": \"11:22:00\", \"weekday\": \"Sunday\"}"}]
2025-06-08 11:22:00,869 - gongdi-api.dashscope - DEBUG - DashscopeClient初始化: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 11:22:00,870 - dashscope - DEBUG - Request body: {'model': 'qwen-turbo', 'parameters': {'temperature': 0, 'max_tokens': 2048, 'result_format': 'message'}, 'input': {'messages': [{'role': 'user', 'content': '时间'}, {'role': 'assistant', 'content': '', 'tool_calls': [{'function': {'name': 'get_current_time', 'arguments': '{}'}, 'index': 0, 'id': 'call_b60aaa1db6bb47d7893b54', 'type': 'function'}]}, {'tool_call_id': 'call_b60aaa1db6bb47d7893b54', 'role': 'tool', 'content': '{"datetime": "2025-06-08 11:22:00", "date": "2025-06-08", "time": "11:22:00", "weekday": "Sunday"}'}]}}
2025-06-08 11:22:00,876 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): dashscope.aliyuncs.com:443
2025-06-08 11:22:04,338 - urllib3.connectionpool - DEBUG - https://dashscope.aliyuncs.com:443 "POST /api/v1/services/aigc/text-generation/generation HTTP/1.1" 200 None
2025-06-08 11:22:04,340 - dashscope - DEBUG - Response: {'output': {'choices': [{'finish_reason': 'stop', 'message': {'role': 'assistant', 'content': "The given data provides the following information about the time:\n\n- **Full datetime**: June 8, 2025, at 11:22:00 AM\n- **Date**: June 8, 2025\n- **Time**: 11:22:00 AM\n- **Weekday**: Sunday\n\nIs there anything specific you would like to know or any particular operation you'd like to perform with this time data?"}}]}, 'usage': {'total_tokens': 176, 'output_tokens': 97, 'input_tokens': 79, 'prompt_tokens_details': {'cached_tokens': 0}}, 'request_id': '30dfb514-fd89-9d48-9230-65709b1ba7c8'}
2025-06-08 11:22:04,345 - gongdi-api - DEBUG - 模型最终响应: {'status_code': <HTTPStatus.OK: 200>, 'request_id': '30dfb514-fd89-9d48-9230-65709b1ba7c8', 'choices': [{'message': {'content': "The given data provides the following information about the time:\n\n- **Full datetime**: June 8, 2025, at 11:22:00 AM\n- **Date**: June 8, 2025\n- **Time**: 11:22:00 AM\n- **Weekday**: Sunday\n\nIs there anything specific you would like to know or any particular operation you'd like to perform with this time data?", 'role': 'assistant'}}], 'usage': {}}
2025-06-08 11:22:04,347 - gongdi-api - DEBUG - 最终返回结果: {'status_code': <HTTPStatus.OK: 200>, 'request_id': '0ebe7ed1-1a37-90dc-a425-eb4ca0251967', 'message': Message({'role': 'assistant', 'content': '', 'tool_calls': [{'function': {'name': 'get_current_time', 'arguments': '{}'}, 'index': 0, 'id': 'call_b60aaa1db6bb47d7893b54', 'type': 'function'}]}), 'tool_calls': [{'id': 'call_b60aaa1db6bb47d7893b54', 'function_name': 'get_current_time', 'arguments': {}}], 'executed_results': [{'id': 'call_b60aaa1db6bb47d7893b54', 'function_name': 'get_current_time', 'success': True, 'result': {'datetime': '2025-06-08 11:22:00', 'date': '2025-06-08', 'time': '11:22:00', 'weekday': 'Sunday'}}], 'final_answer': "The given data provides the following information about the time:\n\n- **Full datetime**: June 8, 2025, at 11:22:00 AM\n- **Date**: June 8, 2025\n- **Time**: 11:22:00 AM\n- **Weekday**: Sunday\n\nIs there anything specific you would like to know or any particular operation you'd like to perform with this time data?"}
2025-06-08 11:22:54,068 - gongdi-api - DEBUG - 接收到函数调用请求: {'query': '北京天气如何', 'tools': [{}]}
2025-06-08 11:22:54,071 - gongdi-api - DEBUG - 使用默认工具: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 11:22:54,073 - gongdi-api - DEBUG - 调用DashscopeClient处理请求，query: 北京天气如何
2025-06-08 11:22:54,074 - gongdi-api.dashscope - DEBUG - DashscopeClient初始化: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 11:22:54,074 - gongdi-api.dashscope - DEBUG - 接收function_call请求: messages=[{'role': 'user', 'content': '北京天气如何'}]
2025-06-08 11:22:54,075 - gongdi-api.dashscope - DEBUG - 原始工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 11:22:54,078 - gongdi-api.dashscope - DEBUG - 格式化后的工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 11:22:54,079 - gongdi-api.dashscope - DEBUG - 调用DashScope API参数: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 11:22:54,080 - gongdi-api.dashscope - DEBUG - 开始调用DashScope API...
2025-06-08 11:22:54,081 - dashscope - DEBUG - Request body: {'model': 'qwen-turbo', 'parameters': {'tools': [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}], 'temperature': 0, 'max_tokens': 2048, 'result_format': 'message'}, 'input': {'messages': [{'role': 'user', 'content': '北京天气如何'}]}}
2025-06-08 11:22:54,087 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): dashscope.aliyuncs.com:443
2025-06-08 11:22:56,402 - urllib3.connectionpool - DEBUG - https://dashscope.aliyuncs.com:443 "POST /api/v1/services/aigc/text-generation/generation HTTP/1.1" 200 None
2025-06-08 11:22:56,404 - dashscope - DEBUG - Response: {'output': {'choices': [{'finish_reason': 'tool_calls', 'message': {'role': 'assistant', 'tool_calls': [{'function': {'name': 'get_current_weather', 'arguments': '{"location": "北京市"}'}, 'index': 0, 'id': 'call_13b7b34a624c48928caa48', 'type': 'function'}], 'content': ''}}]}, 'usage': {'total_tokens': 242, 'output_tokens': 18, 'input_tokens': 224, 'prompt_tokens_details': {'cached_tokens': 0}}, 'request_id': '90ac821e-ab0d-9619-bc7c-0906b1cd7cc6'}
2025-06-08 11:22:56,411 - gongdi-api.dashscope - DEBUG - DashScope API响应状态码: 200
2025-06-08 11:22:56,411 - gongdi-api.dashscope - DEBUG - 成功处理响应: request_id=90ac821e-ab0d-9619-bc7c-0906b1cd7cc6
2025-06-08 11:22:56,412 - gongdi-api - DEBUG - API响应: {'status_code': <HTTPStatus.OK: 200>, 'request_id': '90ac821e-ab0d-9619-bc7c-0906b1cd7cc6', 'choices': [{'message': Message({'role': 'assistant', 'content': '', 'tool_calls': [{'function': {'name': 'get_current_weather', 'arguments': '{"location": "北京市"}'}, 'index': 0, 'id': 'call_13b7b34a624c48928caa48', 'type': 'function'}]})}], 'usage': {}}
2025-06-08 11:22:56,413 - gongdi-api - DEBUG - 工具调用信息: {'id': 'call_13b7b34a624c48928caa48', 'function_name': 'get_current_weather', 'arguments': {'location': '北京市'}}
2025-06-08 11:22:56,414 - gongdi-api - DEBUG - 执行函数: get_current_weather, 参数: {'location': '北京市'}
2025-06-08 11:22:56,414 - gongdi-api - DEBUG - 函数执行结果: {'temp': '20°C', 'condition': '晴', 'humidity': '60%', 'wind': '微风'}
2025-06-08 11:22:56,415 - gongdi-api - DEBUG - 将函数调用结果返回给模型处理
2025-06-08 11:22:56,416 - gongdi-api - DEBUG - 发送给模型的完整消息: [{"role": "user", "content": "北京天气如何"}, {"role": "assistant", "content": "", "tool_calls": [{"function": {"name": "get_current_weather", "arguments": "{\"location\": \"北京市\"}"}, "index": 0, "id": "call_13b7b34a624c48928caa48", "type": "function"}]}, {"tool_call_id": "call_13b7b34a624c48928caa48", "role": "tool", "content": "{\"temp\": \"20\\u00b0C\", \"condition\": \"\\u6674\", \"humidity\": \"60%\", \"wind\": \"\\u5fae\\u98ce\"}"}]
2025-06-08 11:22:56,417 - gongdi-api.dashscope - DEBUG - DashscopeClient初始化: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 11:22:56,418 - dashscope - DEBUG - Request body: {'model': 'qwen-turbo', 'parameters': {'temperature': 0, 'max_tokens': 2048, 'result_format': 'message'}, 'input': {'messages': [{'role': 'user', 'content': '北京天气如何'}, {'role': 'assistant', 'content': '', 'tool_calls': [{'function': {'name': 'get_current_weather', 'arguments': '{"location": "北京市"}'}, 'index': 0, 'id': 'call_13b7b34a624c48928caa48', 'type': 'function'}]}, {'tool_call_id': 'call_13b7b34a624c48928caa48', 'role': 'tool', 'content': '{"temp": "20\\u00b0C", "condition": "\\u6674", "humidity": "60%", "wind": "\\u5fae\\u98ce"}'}]}}
2025-06-08 11:22:56,423 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): dashscope.aliyuncs.com:443
2025-06-08 11:22:59,011 - urllib3.connectionpool - DEBUG - https://dashscope.aliyuncs.com:443 "POST /api/v1/services/aigc/text-generation/generation HTTP/1.1" 200 None
2025-06-08 11:22:59,013 - dashscope - DEBUG - Response: {'output': {'choices': [{'finish_reason': 'stop', 'message': {'role': 'assistant', 'content': '当前北京的天气情况如下：\n- 温度：20°C\n- 天气状况：晴朗\n- 湿度：60%\n- 风力：微风\n\n请注意适当增减衣物，保持舒适。'}}]}, 'usage': {'total_tokens': 118, 'output_tokens': 52, 'input_tokens': 66, 'prompt_tokens_details': {'cached_tokens': 0}}, 'request_id': '2055f3ad-21ab-97fd-b94c-06e9bf77d6e3'}
2025-06-08 11:22:59,017 - gongdi-api - DEBUG - 模型最终响应: {'status_code': <HTTPStatus.OK: 200>, 'request_id': '2055f3ad-21ab-97fd-b94c-06e9bf77d6e3', 'choices': [{'message': {'content': '当前北京的天气情况如下：\n- 温度：20°C\n- 天气状况：晴朗\n- 湿度：60%\n- 风力：微风\n\n请注意适当增减衣物，保持舒适。', 'role': 'assistant'}}], 'usage': {}}
2025-06-08 11:22:59,018 - gongdi-api - DEBUG - 最终返回结果: {'status_code': <HTTPStatus.OK: 200>, 'request_id': '90ac821e-ab0d-9619-bc7c-0906b1cd7cc6', 'message': Message({'role': 'assistant', 'content': '', 'tool_calls': [{'function': {'name': 'get_current_weather', 'arguments': '{"location": "北京市"}'}, 'index': 0, 'id': 'call_13b7b34a624c48928caa48', 'type': 'function'}]}), 'tool_calls': [{'id': 'call_13b7b34a624c48928caa48', 'function_name': 'get_current_weather', 'arguments': {'location': '北京市'}}], 'executed_results': [{'id': 'call_13b7b34a624c48928caa48', 'function_name': 'get_current_weather', 'success': True, 'result': {'temp': '20°C', 'condition': '晴', 'humidity': '60%', 'wind': '微风'}}], 'final_answer': '当前北京的天气情况如下：\n- 温度：20°C\n- 天气状况：晴朗\n- 湿度：60%\n- 风力：微风\n\n请注意适当增减衣物，保持舒适。'}
2025-06-08 11:23:09,769 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:23:17,479 - gongdi-api - DEBUG - 接收到函数调用请求: {'query': '北京时间？', 'tools': [{}]}
2025-06-08 11:23:17,480 - gongdi-api - DEBUG - 使用默认工具: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 11:23:17,481 - gongdi-api - DEBUG - 调用DashscopeClient处理请求，query: 北京时间？
2025-06-08 11:23:17,481 - gongdi-api.dashscope - DEBUG - DashscopeClient初始化: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 11:23:17,482 - gongdi-api.dashscope - DEBUG - 接收function_call请求: messages=[{'role': 'user', 'content': '北京时间？'}]
2025-06-08 11:23:17,482 - gongdi-api.dashscope - DEBUG - 原始工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 11:23:17,483 - gongdi-api.dashscope - DEBUG - 格式化后的工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 11:23:17,484 - gongdi-api.dashscope - DEBUG - 调用DashScope API参数: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 11:23:17,485 - gongdi-api.dashscope - DEBUG - 开始调用DashScope API...
2025-06-08 11:23:17,486 - dashscope - DEBUG - Request body: {'model': 'qwen-turbo', 'parameters': {'tools': [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}], 'temperature': 0, 'max_tokens': 2048, 'result_format': 'message'}, 'input': {'messages': [{'role': 'user', 'content': '北京时间？'}]}}
2025-06-08 11:23:17,491 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): dashscope.aliyuncs.com:443
2025-06-08 11:23:19,822 - urllib3.connectionpool - DEBUG - https://dashscope.aliyuncs.com:443 "POST /api/v1/services/aigc/text-generation/generation HTTP/1.1" 200 None
2025-06-08 11:23:19,824 - dashscope - DEBUG - Response: {'output': {'choices': [{'finish_reason': 'tool_calls', 'message': {'role': 'assistant', 'tool_calls': [{'function': {'name': 'get_current_time', 'arguments': '{}'}, 'index': 0, 'id': 'call_3718712314a6491794825a', 'type': 'function'}], 'content': ''}}]}, 'usage': {'total_tokens': 236, 'output_tokens': 13, 'input_tokens': 223, 'prompt_tokens_details': {'cached_tokens': 0}}, 'request_id': 'cb0be3af-4e6d-98cb-a9e3-471b91354d6f'}
2025-06-08 11:23:19,829 - gongdi-api.dashscope - DEBUG - DashScope API响应状态码: 200
2025-06-08 11:23:19,830 - gongdi-api.dashscope - DEBUG - 成功处理响应: request_id=cb0be3af-4e6d-98cb-a9e3-471b91354d6f
2025-06-08 11:23:19,831 - gongdi-api - DEBUG - API响应: {'status_code': <HTTPStatus.OK: 200>, 'request_id': 'cb0be3af-4e6d-98cb-a9e3-471b91354d6f', 'choices': [{'message': Message({'role': 'assistant', 'content': '', 'tool_calls': [{'function': {'name': 'get_current_time', 'arguments': '{}'}, 'index': 0, 'id': 'call_3718712314a6491794825a', 'type': 'function'}]})}], 'usage': {}}
2025-06-08 11:23:19,832 - gongdi-api - DEBUG - 工具调用信息: {'id': 'call_3718712314a6491794825a', 'function_name': 'get_current_time', 'arguments': {}}
2025-06-08 11:23:19,833 - gongdi-api - DEBUG - 执行函数: get_current_time, 参数: {}
2025-06-08 11:23:19,834 - gongdi-api - DEBUG - 函数执行结果: {'datetime': '2025-06-08 11:23:19', 'date': '2025-06-08', 'time': '11:23:19', 'weekday': 'Sunday'}
2025-06-08 11:23:19,834 - gongdi-api - DEBUG - 将函数调用结果返回给模型处理
2025-06-08 11:23:19,835 - gongdi-api - DEBUG - 发送给模型的完整消息: [{"role": "user", "content": "北京时间？"}, {"role": "assistant", "content": "", "tool_calls": [{"function": {"name": "get_current_time", "arguments": "{}"}, "index": 0, "id": "call_3718712314a6491794825a", "type": "function"}]}, {"tool_call_id": "call_3718712314a6491794825a", "role": "tool", "content": "{\"datetime\": \"2025-06-08 11:23:19\", \"date\": \"2025-06-08\", \"time\": \"11:23:19\", \"weekday\": \"Sunday\"}"}]
2025-06-08 11:23:19,836 - gongdi-api.dashscope - DEBUG - DashscopeClient初始化: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 11:23:19,837 - dashscope - DEBUG - Request body: {'model': 'qwen-turbo', 'parameters': {'temperature': 0, 'max_tokens': 2048, 'result_format': 'message'}, 'input': {'messages': [{'role': 'user', 'content': '北京时间？'}, {'role': 'assistant', 'content': '', 'tool_calls': [{'function': {'name': 'get_current_time', 'arguments': '{}'}, 'index': 0, 'id': 'call_3718712314a6491794825a', 'type': 'function'}]}, {'tool_call_id': 'call_3718712314a6491794825a', 'role': 'tool', 'content': '{"datetime": "2025-06-08 11:23:19", "date": "2025-06-08", "time": "11:23:19", "weekday": "Sunday"}'}]}}
2025-06-08 11:23:19,841 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): dashscope.aliyuncs.com:443
2025-06-08 11:23:22,689 - urllib3.connectionpool - DEBUG - https://dashscope.aliyuncs.com:443 "POST /api/v1/services/aigc/text-generation/generation HTTP/1.1" 200 None
2025-06-08 11:23:22,692 - dashscope - DEBUG - Response: {'output': {'choices': [{'finish_reason': 'stop', 'message': {'role': 'assistant', 'content': '根据您提供的信息，当前的北京时间是 **2025年6月8日星期日，上午11点23分19秒**。'}}]}, 'usage': {'total_tokens': 113, 'output_tokens': 34, 'input_tokens': 79, 'prompt_tokens_details': {'cached_tokens': 0}}, 'request_id': 'c14bae81-dd42-9272-87e2-c1fd35bef38d'}
2025-06-08 11:23:22,697 - gongdi-api - DEBUG - 模型最终响应: {'status_code': <HTTPStatus.OK: 200>, 'request_id': 'c14bae81-dd42-9272-87e2-c1fd35bef38d', 'choices': [{'message': {'content': '根据您提供的信息，当前的北京时间是 **2025年6月8日星期日，上午11点23分19秒**。', 'role': 'assistant'}}], 'usage': {}}
2025-06-08 11:23:22,698 - gongdi-api - DEBUG - 最终返回结果: {'status_code': <HTTPStatus.OK: 200>, 'request_id': 'cb0be3af-4e6d-98cb-a9e3-471b91354d6f', 'message': Message({'role': 'assistant', 'content': '', 'tool_calls': [{'function': {'name': 'get_current_time', 'arguments': '{}'}, 'index': 0, 'id': 'call_3718712314a6491794825a', 'type': 'function'}]}), 'tool_calls': [{'id': 'call_3718712314a6491794825a', 'function_name': 'get_current_time', 'arguments': {}}], 'executed_results': [{'id': 'call_3718712314a6491794825a', 'function_name': 'get_current_time', 'success': True, 'result': {'datetime': '2025-06-08 11:23:19', 'date': '2025-06-08', 'time': '11:23:19', 'weekday': 'Sunday'}}], 'final_answer': '根据您提供的信息，当前的北京时间是 **2025年6月8日星期日，上午11点23分19秒**。'}
2025-06-08 11:24:08,728 - gongdi-api - DEBUG - 接收到函数调用请求: {'query': '有什么风险吗？', 'tools': [{}]}
2025-06-08 11:24:08,729 - gongdi-api - DEBUG - 使用默认工具: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 11:24:08,731 - gongdi-api - DEBUG - 调用DashscopeClient处理请求，query: 有什么风险吗？
2025-06-08 11:24:08,731 - gongdi-api.dashscope - DEBUG - DashscopeClient初始化: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 11:24:08,732 - gongdi-api.dashscope - DEBUG - 接收function_call请求: messages=[{'role': 'user', 'content': '有什么风险吗？'}]
2025-06-08 11:24:08,732 - gongdi-api.dashscope - DEBUG - 原始工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 11:24:08,734 - gongdi-api.dashscope - DEBUG - 格式化后的工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 11:24:08,735 - gongdi-api.dashscope - DEBUG - 调用DashScope API参数: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 11:24:08,735 - gongdi-api.dashscope - DEBUG - 开始调用DashScope API...
2025-06-08 11:24:08,736 - dashscope - DEBUG - Request body: {'model': 'qwen-turbo', 'parameters': {'tools': [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}], 'temperature': 0, 'max_tokens': 2048, 'result_format': 'message'}, 'input': {'messages': [{'role': 'user', 'content': '有什么风险吗？'}]}}
2025-06-08 11:24:08,741 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): dashscope.aliyuncs.com:443
2025-06-08 11:24:11,538 - urllib3.connectionpool - DEBUG - https://dashscope.aliyuncs.com:443 "POST /api/v1/services/aigc/text-generation/generation HTTP/1.1" 200 None
2025-06-08 11:24:11,540 - dashscope - DEBUG - Response: {'output': {'choices': [{'finish_reason': 'stop', 'message': {'role': 'assistant', 'content': '您的问题比较宽泛，风险可能涉及很多方面，例如金融投资风险、健康风险、技术风险等。如果您能提供更具体的情境或者领域，我可以为您提供更有针对性的信息和建议。'}}]}, 'usage': {'total_tokens': 267, 'output_tokens': 42, 'input_tokens': 225, 'prompt_tokens_details': {'cached_tokens': 0}}, 'request_id': 'e18d3fdd-b629-97ac-9dac-3be17776b7ce'}
2025-06-08 11:24:11,544 - gongdi-api.dashscope - DEBUG - DashScope API响应状态码: 200
2025-06-08 11:24:11,545 - gongdi-api.dashscope - DEBUG - 成功处理响应: request_id=e18d3fdd-b629-97ac-9dac-3be17776b7ce
2025-06-08 11:24:11,546 - gongdi-api - DEBUG - API响应: {'status_code': <HTTPStatus.OK: 200>, 'request_id': 'e18d3fdd-b629-97ac-9dac-3be17776b7ce', 'choices': [{'message': Message({'role': 'assistant', 'content': '您的问题比较宽泛，风险可能涉及很多方面，例如金融投资风险、健康风险、技术风险等。如果您能提供更具体的情境或者领域，我可以为您提供更有针对性的信息和建议。'})}], 'usage': {}}
2025-06-08 11:24:11,548 - gongdi-api - DEBUG - 响应中没有工具调用
2025-06-08 11:26:22,175 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:26:22,219 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:26:22,237 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:26:23,398 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:26:23,574 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:26:24,012 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:26:24,373 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:26:24,386 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi4\logs\gongdi_api.log
2025-06-08 11:26:25,067 - asyncio - DEBUG - Using selector: SelectSelector
2025-06-08 11:26:32,005 - gongdi-api - DEBUG - 接收到函数调用请求: {'query': '有什么风险吗？', 'tools': [{}]}
2025-06-08 11:26:32,006 - gongdi-api - DEBUG - 使用默认工具: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 11:26:32,007 - gongdi-api - DEBUG - 调用DashscopeClient处理请求，query: 有什么风险吗？
2025-06-08 11:26:32,008 - gongdi-api.dashscope - DEBUG - DashscopeClient初始化: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 11:26:32,009 - gongdi-api.dashscope - DEBUG - 接收function_call请求: messages=[{'role': 'user', 'content': '有什么风险吗？'}]
2025-06-08 11:26:32,009 - gongdi-api.dashscope - DEBUG - 原始工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 11:26:32,011 - gongdi-api.dashscope - DEBUG - 格式化后的工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 11:26:32,012 - gongdi-api.dashscope - DEBUG - 调用DashScope API参数: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 11:26:32,013 - gongdi-api.dashscope - DEBUG - 开始调用DashScope API...
2025-06-08 11:26:32,151 - dashscope - DEBUG - Request body: {'model': 'qwen-turbo', 'parameters': {'tools': [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}], 'temperature': 0, 'max_tokens': 2048, 'result_format': 'message'}, 'input': {'messages': [{'role': 'user', 'content': '有什么风险吗？'}]}}
2025-06-08 11:26:32,161 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): dashscope.aliyuncs.com:443
2025-06-08 11:26:34,683 - urllib3.connectionpool - DEBUG - https://dashscope.aliyuncs.com:443 "POST /api/v1/services/aigc/text-generation/generation HTTP/1.1" 200 None
2025-06-08 11:26:34,686 - dashscope - DEBUG - Response: {'output': {'choices': [{'finish_reason': 'stop', 'message': {'role': 'assistant', 'content': '您的问题比较宽泛，风险可能涉及很多方面，如健康风险、金融风险、技术风险等。如果您能提供更具体的情境或者领域，我可以为您提供更有针对性的信息和建议。'}}]}, 'usage': {'total_tokens': 266, 'output_tokens': 41, 'input_tokens': 225, 'prompt_tokens_details': {'cached_tokens': 128}}, 'request_id': '2d47e3cb-54e0-982e-9011-35183e918905'}
2025-06-08 11:26:34,692 - gongdi-api.dashscope - DEBUG - DashScope API响应状态码: 200
2025-06-08 11:26:34,693 - gongdi-api.dashscope - DEBUG - 成功处理响应: request_id=2d47e3cb-54e0-982e-9011-35183e918905
2025-06-08 11:26:34,694 - gongdi-api - DEBUG - API响应: {'status_code': <HTTPStatus.OK: 200>, 'request_id': '2d47e3cb-54e0-982e-9011-35183e918905', 'choices': [{'message': Message({'role': 'assistant', 'content': '您的问题比较宽泛，风险可能涉及很多方面，如健康风险、金融风险、技术风险等。如果您能提供更具体的情境或者领域，我可以为您提供更有针对性的信息和建议。'})}], 'usage': {}}
2025-06-08 11:26:34,695 - gongdi-api - DEBUG - 响应中没有工具调用
2025-06-08 11:33:38,961 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi-fastapi\logs\gongdi_api.log
2025-06-08 11:33:38,995 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi-fastapi\logs\gongdi_api.log
2025-06-08 11:33:41,641 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi-fastapi\logs\gongdi_api.log
2025-06-08 11:33:41,645 - gongdi-api - INFO - 日志文件路径: C:\code\gongdi-fastapi\logs\gongdi_api.log
2025-06-08 11:33:42,542 - asyncio - DEBUG - Using selector: SelectSelector
2025-06-08 11:34:20,530 - gongdi-api - DEBUG - 接收到函数调用请求: {'query': '北京时间', 'tools': [{}]}
2025-06-08 11:34:20,530 - gongdi-api - DEBUG - 使用默认工具: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 11:34:20,532 - gongdi-api - DEBUG - 调用DashscopeClient处理请求，query: 北京时间
2025-06-08 11:34:20,532 - gongdi-api.dashscope - DEBUG - DashscopeClient初始化: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 11:34:20,533 - gongdi-api.dashscope - DEBUG - 接收function_call请求: messages=[{'role': 'user', 'content': '北京时间'}]
2025-06-08 11:34:20,533 - gongdi-api.dashscope - DEBUG - 原始工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 11:34:20,535 - gongdi-api.dashscope - DEBUG - 格式化后的工具列表: [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}]
2025-06-08 11:34:20,536 - gongdi-api.dashscope - DEBUG - 调用DashScope API参数: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 11:34:20,536 - gongdi-api.dashscope - DEBUG - 开始调用DashScope API...
2025-06-08 11:34:20,608 - dashscope - DEBUG - Request body: {'model': 'qwen-turbo', 'parameters': {'tools': [{'type': 'function', 'function': {'name': 'get_current_time', 'description': '当你想知道现在的时间时非常有用。', 'parameters': {}}}, {'type': 'function', 'function': {'name': 'get_current_weather', 'description': '当你想查询指定城市的天气时非常有用。', 'parameters': {'type': 'object', 'properties': {'location': {'type': 'string', 'description': '城市或县区，比如北京市、杭州市、余杭区等。'}}, 'required': ['location']}}}], 'temperature': 0, 'max_tokens': 2048, 'result_format': 'message'}, 'input': {'messages': [{'role': 'user', 'content': '北京时间'}]}}
2025-06-08 11:34:20,612 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): dashscope.aliyuncs.com:443
2025-06-08 11:34:22,427 - urllib3.connectionpool - DEBUG - https://dashscope.aliyuncs.com:443 "POST /api/v1/services/aigc/text-generation/generation HTTP/1.1" 200 None
2025-06-08 11:34:22,429 - dashscope - DEBUG - Response: {'output': {'choices': [{'finish_reason': 'tool_calls', 'message': {'role': 'assistant', 'tool_calls': [{'function': {'name': 'get_current_time', 'arguments': '{}'}, 'index': 0, 'id': 'call_d9a6bc21f22c47a49b0b59', 'type': 'function'}], 'content': ''}}]}, 'usage': {'total_tokens': 235, 'output_tokens': 13, 'input_tokens': 222, 'prompt_tokens_details': {'cached_tokens': 128}}, 'request_id': '8036ba76-d892-951c-9dcc-9a51ff64b003'}
2025-06-08 11:34:22,432 - gongdi-api.dashscope - DEBUG - DashScope API响应状态码: 200
2025-06-08 11:34:22,433 - gongdi-api.dashscope - DEBUG - 成功处理响应: request_id=8036ba76-d892-951c-9dcc-9a51ff64b003
2025-06-08 11:34:22,434 - gongdi-api - DEBUG - API响应: {'status_code': <HTTPStatus.OK: 200>, 'request_id': '8036ba76-d892-951c-9dcc-9a51ff64b003', 'choices': [{'message': Message({'role': 'assistant', 'content': '', 'tool_calls': [{'function': {'name': 'get_current_time', 'arguments': '{}'}, 'index': 0, 'id': 'call_d9a6bc21f22c47a49b0b59', 'type': 'function'}]})}], 'usage': {}}
2025-06-08 11:34:22,436 - gongdi-api - DEBUG - 工具调用信息: {'id': 'call_d9a6bc21f22c47a49b0b59', 'function_name': 'get_current_time', 'arguments': {}}
2025-06-08 11:34:22,437 - gongdi-api - DEBUG - 执行函数: get_current_time, 参数: {}
2025-06-08 11:34:22,438 - gongdi-api - DEBUG - 函数执行结果: {'datetime': '2025-06-08 11:34:22', 'date': '2025-06-08', 'time': '11:34:22', 'weekday': 'Sunday'}
2025-06-08 11:34:22,438 - gongdi-api - DEBUG - 将函数调用结果返回给模型处理
2025-06-08 11:34:22,439 - gongdi-api - DEBUG - 发送给模型的完整消息: [{"role": "user", "content": "北京时间"}, {"role": "assistant", "content": "", "tool_calls": [{"function": {"name": "get_current_time", "arguments": "{}"}, "index": 0, "id": "call_d9a6bc21f22c47a49b0b59", "type": "function"}]}, {"tool_call_id": "call_d9a6bc21f22c47a49b0b59", "role": "tool", "content": "{\"datetime\": \"2025-06-08 11:34:22\", \"date\": \"2025-06-08\", \"time\": \"11:34:22\", \"weekday\": \"Sunday\"}"}]
2025-06-08 11:34:22,440 - gongdi-api.dashscope - DEBUG - DashscopeClient初始化: model=qwen-turbo, temperature=0, max_tokens=2048
2025-06-08 11:34:22,441 - dashscope - DEBUG - Request body: {'model': 'qwen-turbo', 'parameters': {'temperature': 0, 'max_tokens': 2048, 'result_format': 'message'}, 'input': {'messages': [{'role': 'user', 'content': '北京时间'}, {'role': 'assistant', 'content': '', 'tool_calls': [{'function': {'name': 'get_current_time', 'arguments': '{}'}, 'index': 0, 'id': 'call_d9a6bc21f22c47a49b0b59', 'type': 'function'}]}, {'tool_call_id': 'call_d9a6bc21f22c47a49b0b59', 'role': 'tool', 'content': '{"datetime": "2025-06-08 11:34:22", "date": "2025-06-08", "time": "11:34:22", "weekday": "Sunday"}'}]}}
2025-06-08 11:34:22,446 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): dashscope.aliyuncs.com:443
2025-06-08 11:34:25,896 - urllib3.connectionpool - DEBUG - https://dashscope.aliyuncs.com:443 "POST /api/v1/services/aigc/text-generation/generation HTTP/1.1" 200 None
2025-06-08 11:34:25,898 - dashscope - DEBUG - Response: {'output': {'choices': [{'finish_reason': 'stop', 'message': {'role': 'assistant', 'content': 'The given JSON data provides the following information about the date and time in Beijing Time:\n\n- **datetime**: `2025-06-08 11:34:22` (full timestamp)\n- **date**: `2025-06-08` (only the date)\n- **time**: `11:34:22` (only the time)\n- **weekday**: `Sunday` (the day of the week)\n\nThis indicates that the specific moment is Sunday, June 8, 2025, at 11:34:22 in the morning, according to Beijing Time.'}}]}, 'usage': {'total_tokens': 217, 'output_tokens': 138, 'input_tokens': 79, 'prompt_tokens_details': {'cached_tokens': 0}}, 'request_id': '0a16dade-2915-9690-9330-9b6fe76e6362'}
2025-06-08 11:34:25,904 - gongdi-api - DEBUG - 模型最终响应: {'status_code': <HTTPStatus.OK: 200>, 'request_id': '0a16dade-2915-9690-9330-9b6fe76e6362', 'choices': [{'message': {'content': 'The given JSON data provides the following information about the date and time in Beijing Time:\n\n- **datetime**: `2025-06-08 11:34:22` (full timestamp)\n- **date**: `2025-06-08` (only the date)\n- **time**: `11:34:22` (only the time)\n- **weekday**: `Sunday` (the day of the week)\n\nThis indicates that the specific moment is Sunday, June 8, 2025, at 11:34:22 in the morning, according to Beijing Time.', 'role': 'assistant'}}], 'usage': {}}
2025-06-08 11:34:25,906 - gongdi-api - DEBUG - 最终返回结果: {'status_code': <HTTPStatus.OK: 200>, 'request_id': '8036ba76-d892-951c-9dcc-9a51ff64b003', 'message': Message({'role': 'assistant', 'content': '', 'tool_calls': [{'function': {'name': 'get_current_time', 'arguments': '{}'}, 'index': 0, 'id': 'call_d9a6bc21f22c47a49b0b59', 'type': 'function'}]}), 'tool_calls': [{'id': 'call_d9a6bc21f22c47a49b0b59', 'function_name': 'get_current_time', 'arguments': {}}], 'executed_results': [{'id': 'call_d9a6bc21f22c47a49b0b59', 'function_name': 'get_current_time', 'success': True, 'result': {'datetime': '2025-06-08 11:34:22', 'date': '2025-06-08', 'time': '11:34:22', 'weekday': 'Sunday'}}], 'final_answer': 'The given JSON data provides the following information about the date and time in Beijing Time:\n\n- **datetime**: `2025-06-08 11:34:22` (full timestamp)\n- **date**: `2025-06-08` (only the date)\n- **time**: `11:34:22` (only the time)\n- **weekday**: `Sunday` (the day of the week)\n\nThis indicates that the specific moment is Sunday, June 8, 2025, at 11:34:22 in the morning, according to Beijing Time.'}
